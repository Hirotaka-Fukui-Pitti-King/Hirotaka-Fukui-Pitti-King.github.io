[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This is the personal website of Hirotaka Fukui, a graduate student in Economics.\nI have included information about my research, CV, and how to get in touch with me."
  },
  {
    "objectID": "about.html#welcome",
    "href": "about.html#welcome",
    "title": "About",
    "section": "Welcome",
    "text": "Welcome\nThis is the personal website of Hirotaka Fukui, a graduate student in Economics.\nI have included information about my research, CV, and how to get in touch with me."
  },
  {
    "objectID": "about.html#about-me",
    "href": "about.html#about-me",
    "title": "About",
    "section": "About Me",
    "text": "About Me\nI am a graduate student in Economics at  Kobe University, Graduate School of Economics.\nMy research focuses on International Macroeconomics, Monetary Economics, Emerging and Developing Economies, with a particular emphasis on Sub-Saharan Africa.\n\nFeel free to reach out!\n\n\n\n     \n     \n      \n     \n     \n\n\n\n\n“The study of economics does not seem to require any specialised gifts of an unusually high order. Is it not, intellectually regarded, a very easy subject compared with the higher branches of philosophy and pure science? Yet good, or even competent, economists are the rarest of birds. An easy subject, at which very few excel! The paradox finds its explanation, perhaps, in that the master-economist must possess a rare combination of gifts. He must reach a high standard in several different directions and must combine talents not often found together. He must be mathematician, historian, statesman, philosopher—​in some degree. He must understand symbols and speak in words. He must contemplate the particular in terms of the general, and touch abstract and concrete in the same flight of thought. He must study the present in the light of the past for the purposes of the future. No part of man’s nature or his institutions must lie entirely outside his regard. He must be purposeful and disinterested in a simultaneous mood; as aloof and incorruptible as an artist, yet sometimes as near the earth as a politician.”\n\n\n\n— John Maynard Keynes, “Alfred Marshall, 1842–1924.” The Economic Journal (1924)"
  },
  {
    "objectID": "contact.html",
    "href": "contact.html",
    "title": "Contact",
    "section": "",
    "text": "Get in Touch\n\n\nFeel free to reach out for research discussions, collaborations, or academic inquiries.\n\n\n&lt;!-- ========= EMAIL ========= --&gt;\n&lt;a href=\"mailto:227e127e@gsuite.kobe-u.ac.jp\" class=\"icon-card\" target=\"_blank\"&gt;\n  &lt;!-- Heroicons: envelope-solid --&gt;\n  &lt;svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"#ffffff\" width=\"42\" height=\"42\"&gt;\n    &lt;path d=\"M1.5 4.5A2.5 2.5 0 0 1 4 2h16a2.5 2.5 0 0 1 2.5 2.5v15A2.5 2.5 0 0 1 20 22H4a2.5 2.5 0 0 1-2.5-2.5v-15Zm3 .5 7 5 7-5H4.5Zm15 2.25-7.35 5.25a1 1 0 0 1-1.3 0L3.5 7.25V19.5A1.5 1.5 0 0 0 5 21h14a1.5 1.5 0 0 0 1.5-1.5V7.25Z\"/&gt;\n  &lt;/svg&gt;\n  &lt;div&gt;Email&lt;/div&gt;\n&lt;/a&gt;\n\n&lt;!-- ========= GitHub ========= --&gt;\n&lt;a href=\"https://github.com/Hirotaka-Fukui-Pitti-King\" class=\"icon-card\" target=\"_blank\"&gt;\n  &lt;!-- Brandico GitHub --&gt;\n  &lt;svg xmlns=\"http://www.w3.org/2000/svg\" width=\"42\" height=\"42\" viewBox=\"0 0 24 24\" fill=\"#ffffff\"&gt;\n    &lt;path d=\"M12 .5C5.648.5.5 5.648.5 12c0 5.086 3.292 9.387 7.863 10.907.575.108.787-.25.787-.556 0-.275-.012-1.184-.012-2.152-3.2.694-3.875-1.356-3.875-1.356-.525-1.31-1.281-1.66-1.281-1.66-1.05-.719.075-.706.075-.706 1.162.081 1.775 1.194 1.775 1.194 1.031 1.775 2.7 1.262 3.362.963.106-.744.406-1.262.738-1.556-2.556-.288-5.244-1.281-5.244-5.7 0-1.262.45-2.294 1.181-3.1-.119-.294-.519-1.5.106-3.119 0 0 .975-.312 3.2 1.181a11.06 11.06 0 0 1 2.919-.394 11.1 11.1 0 0 1 2.919.394c2.225-1.494 3.2-1.181 3.2-1.181.625 1.619.225 2.825.106 3.119.744.806 1.181 1.838 1.181 3.1 0 4.431-2.7 5.4-5.269 5.681.419.356.794 1.075.794 2.181 0 1.575-.012 2.844-.012 3.231 0 .306.212.675.787.556A10.99 10.99 0 0 0 23.5 12C23.5 5.648 18.356.5 12 .5Z\"/&gt;\n  &lt;/svg&gt;\n  &lt;div&gt;GitHub&lt;/div&gt;\n&lt;/a&gt;\n\n&lt;!-- ========= ORCID ========= --&gt;\n&lt;a href=\"https://orcid.org/0009-0004-9796-9148\" class=\"icon-card\" target=\"_blank\"&gt;\n  &lt;!-- Academicons ORCID --&gt;\n  &lt;svg xmlns=\"http://www.w3.org/2000/svg\" width=\"42\" height=\"42\" viewBox=\"0 0 24 24\"&gt;\n    &lt;circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#A6CE39\"/&gt;\n    &lt;path fill=\"#ffffff\" d=\"M9.5 7.4v9.2H7.7V7.4h1.8zm2.2 0v1.5h-.1c-.3-.6-.8-1.1-1.5-1.3-.3-.1-.7-.1-1.1-.1H9v1.8h.7c.6 0 1.1.2 1.4.7.4.5.6 1.2.6 2.1v5.4h1.8v-5.3c0-1.3-.3-2.3-.8-3-.5-.7-1.2-1.1-2.1-1.1h-.1zm3.9 2.4h1.7v6.8h-1.8V9.8zm.8-2.3c.6 0 1-.4 1-.9s-.4-.9-1-.9c-.5 0-1 .4-1 .9s.4.9 1 .9z\"/&gt;\n  &lt;/svg&gt;\n  &lt;div&gt;ORCID&lt;/div&gt;\n&lt;/a&gt;\n\n&lt;!-- ========= LinkedIn ========= --&gt;\n&lt;a href=\"https://www.linkedin.com/in/hirotaka-fukui-90495b342\" class=\"icon-card\" target=\"_blank\"&gt;\n  &lt;!-- Brandico LinkedIn Rect --&gt;\n  &lt;svg xmlns=\"http://www.w3.org/2000/svg\" width=\"42\" height=\"42\" viewBox=\"0 0 24 24\" fill=\"#0077B5\"&gt;\n    &lt;path d=\"M4.98 3.5C4.98 4.6 4.07 5.5 2.98 5.5 1.89 5.5 1 4.6 1 3.5 1 2.4 1.89 1.5 2.98 1.5 4.07 1.5 4.98 2.4 4.98 3.5zM1.5 8h3v14h-3V8zM8.5 8h2.9v1.9h.1c.4-.7 1.4-1.5 2.9-1.5 3.1 0 3.7 2 3.7 4.6V22h-3v-7.1c0-1.7 0-3.8-2.3-3.8-2.3 0-2.7 1.8-2.7 3.6V22h-3V8z\"/&gt;\n  &lt;/svg&gt;\n  &lt;div&gt;LinkedIn&lt;/div&gt;\n&lt;/a&gt;\n\n&lt;!-- ========= X (official logo) ========= --&gt;\n&lt;a href=\"https://x.com/PittiKing\" class=\"icon-card\" target=\"_blank\"&gt;\n  &lt;!-- Official X SVG (Black) --&gt;\n  &lt;svg width=\"42\" height=\"42\" viewBox=\"0 0 24 24\" fill=\"#ffffff\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;path d=\"M18.244 2.25H21.5l-7.51 8.602L23.25 21.75h-6.438l-4.98-6.053-5.7 6.053H.75l8.175-8.667L.75 2.25h6.597l4.53 5.425 5.367-5.425Z\"/&gt;\n  &lt;/svg&gt;\n  &lt;div&gt;X (Twitter)&lt;/div&gt;\n&lt;/a&gt;"
  },
  {
    "objectID": "cv.html",
    "href": "cv.html",
    "title": "CV",
    "section": "",
    "text": "Coming soon."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Hirotaka Fukui",
    "section": "",
    "text": "ABOUT\n      RESEARCH\n    \n  \n\n\n\n\n  \n    Hirotaka Fukui\n    Kobe University, Graduate School of Economics, Ph.D. Student\n    International Macroeconomics・Monetary Economics・EMDEs\n    \n        VIEW RESEARCH\n        GET IN TOUCH"
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html",
    "href": "notes/Macroiv_assign1_TA.html",
    "title": "Exercise 1: Numerical Methods",
    "section": "",
    "text": "授業ではガウス–エルミート求積によって正規分布での期待値を近似する方法を学んだ。\nこの方法は多変量正規分布に対しても適用できる。\n以下のような joint utility maximization problem を考える：\n\\[\n\\max_{c_m, c_f, l_m, l_f} \\; u(c_m, l_m) + u(c_f, l_f)\n\\quad \\text{s.t.} \\quad\nc_m + c_f = w_m (1 - l_m) + w_f (1 - l_f)\n\\]\nここで効用関数 \\(u(c,l)\\) は以下のように定義される：\n\\[\nu(c,l) = \\frac{c^{1 - \\gamma_c} - 1}{1 - \\gamma_c}\n+ \\frac{l^{1 - \\gamma_l} - 1}{1 - \\gamma_l}.\n\\]\n夫婦の対数時間給は次の多変量正規分布に従うとする：\n\\[\n\\log\n\\begin{pmatrix}\nw_m \\\\ w_f\n\\end{pmatrix}\n\\sim\n\\mathcal{N}\\!\\left(\n\\begin{pmatrix}\n\\mu_m \\\\ \\mu_f\n\\end{pmatrix},\n\\begin{pmatrix}\n\\sigma_m^2 & \\rho \\sigma_m \\sigma_f \\\\\n\\cdot & \\sigma_f^2\n\\end{pmatrix}\n\\right).\n\\]\n\n\nコアコースのミクロ経済学の講義を思い出してみましょう1。\n\n\n最大解を導く一般的な手順は以下の通りです。\n\n最大解が存在することを確認する。\n\n微分不可能な点を排除する。\n\nFJ条件と制約条件を満たす \\((x, \\lambda)\\) の組を求める。\n\n唯一の候補があればそれが最大解。複数ある場合は \\(g_0\\) を比較する。\n\n微分不可能な点がある場合は直接比較で確認する。\n\nFJ条件（Fritz John 条件）は以下の定理により与えられます。\n\nTheorem 1 定理 1（フリッツ・ジョン定理）\n\\(\\hat{x} \\in \\mathbb{R}^n\\) を最大化問題 (P) の解とする。 この \\(\\hat{x}\\) においてすべての \\(g_j\\) が微分可能ならば， \\(\\lambda = (\\lambda_0, \\dots, \\lambda_l) \\in \\mathbb{R}^{l+1}\\) が存在し，\n\\[\n\\begin{aligned}\n\\text{(a)} &\\quad\n\\sum_{j=0}^l \\lambda_j \\frac{\\partial g_j(\\hat{x})}{\\partial x_i} = 0,\n&& \\forall i = 1, \\dots, n \\quad \\text{(1階条件)}\\\\[0.5em]\n\\text{(b)} &\\quad\n\\lambda_j \\ge 0 \\quad \\forall j \\ge 0 && \\text{(非負条件)} \\\\[0.5em]\n\\text{(c)} &\\quad\n\\lambda_j &gt; 0 \\ \\text{for some } j \\ge 0 && \\text{(非ゼロ条件)} \\\\[0.5em]\n\\text{(d)} &\\quad\n\\lambda_j g_j(\\hat{x}) = 0 \\quad \\forall j \\ge 1 && \\text{(相補スラック条件)}\n\\end{aligned}\n\\]\n\n以下ではこのフレームワークに沿って問1に解答していきます。\n\n\n\n\n\\(\\gamma_c = \\gamma_l = 1\\)、すなわち \\(u(c,l) = \\log c + \\log l\\) とする。\n\\(w_m, w_f\\) を所与として、\\(c_m, c_f, l_m, l_f\\) の解析解を求めよ。\nただし、\\(l_m = 1\\) または \\(l_f = 1\\) となる端点解にも注意せよ。\n\n\n\n\n効用関数 \\(u(c,l)=\\log c+\\log l\\) は定義域 \\((0,\\infty)\\times(0,1]\\) 上で連続。\n制約集合\n\\[\nc_m + c_f = w_m (1-l_m) + w_f (1-l_f), \\quad\nc_m, c_f \\ge 0, \\quad l_m, l_f \\in [0,1]\n\\]\nは閉かつ有界（コンパクト）なので、ワイエルシュトラスの定理より最大解は存在。\nさらに \\(\\log\\) 関数は厳密に凹であるため、最大解は一意です2。\n\n\n\n制約条件は次の通りです：\n\\[\n\\begin{aligned}\ng_0 &: u(c,l) = \\log c_m + \\log l_m + \\log c_f + \\log l_f,\\\\\ng_1 &: w_m (1 - l_m) + w_f (1 - l_f) - c_m - c_f \\ge 0,\\\\\ng_2 &: 1 - l_m \\ge 0,\\quad g_3 : 1 - l_f \\ge 0,\\\\\ng_4 &: c_m \\ge 0,\\quad g_5 : c_f \\ge 0,\\\\\ng_6 &: l_m \\ge 0,\\quad g_7 : l_f \\ge 0.\n\\end{aligned}\n\\]\n\\(g_1,\\ldots,g_7\\) はアフィンなので全域で微分可能です。\n問題は \\(g_0 = \\log c_m + \\log l_m + \\log c_f + \\log l_f\\) のみです。\n\\(c_i=0\\) または \\(l_i=0\\) の点では \\(\\log 0 = -\\infty\\) のため微分不能となります。\nこれらが最大解にならないことを確認します。\n\n\n\\((c_m, c_f, l_m=0, l_f)\\) を考えます。\n小さい \\(\\varepsilon&gt;0\\) をとり、\\(\\Delta l_m = \\varepsilon\\) だけ余暇を増やすことにします。\nそのぶん労働所得 \\(w_m \\varepsilon\\) 減少させることで消費も \\(\\Delta c_m = -w_m \\varepsilon\\) だけ減らす事が可能です。\n効用差は：\n\\[\nf(\\varepsilon) = u(c_m - w_m \\varepsilon, \\varepsilon, c_f, l_f)\n- u(c_m, 0, c_f, l_f)\n\\]\n微分すると：\n\\[\nf'(0+) = -\\frac{w_m}{c_m} + \\frac{1}{\\varepsilon}\\Big|_{\\varepsilon \\to 0+} = +\\infty\n\\]\nしたがって \\(f(\\varepsilon)&gt;0\\)。\nよって \\(l_m=0\\) は最大解ではありません。同様に \\(l_f=0\\) も排除されます。\n\n\n\n\\((c_m=0, c_f, l_m, l_f)\\) を考えます。\n小さい \\(\\delta&gt;0\\) に対して \\(c_m\\) を \\(\\delta\\) 増やし、その分 \\(c_f\\) を減らす事を考えます：\n\\[\ng(\\delta) = \\log \\delta + \\log(c_f - \\delta) - (\\log 0 + \\log c_f)\n\\]\n微分すると：\n\\[\ng'(0+) = \\frac{1}{\\delta}\\Big|_{\\delta \\to 0+} - \\frac{1}{c_f} = +\\infty\n\\]\nしたがって、\\(c_m=0\\) も最大解ではなく、\\(c_f=0\\) も同様に排除されます。以上より最大解は次の領域に存在することがわかりました：\n\\[\nc_m&gt;0,\\quad c_f&gt;0,\\quad 1\\ge l_m&gt;0,\\quad 1\\ge l_f&gt;0.\n\\]\nこの領域では \\(u(c,l)\\) は滑らかで、FJ条件を適用できます。\n\n\n\n\nここまでで最大解となる候補が \\(c_m&gt;0,\\quad c_f&gt;0,\\quad 1\\ge l_m&gt;0,\\quad 1\\ge l_f&gt;0\\)に存在することがわかりました。 ここからはこの範囲の解が本当に最大解なのかどうかをFJ条件を使って調べていきます。\n\n\n\\[\n\\begin{aligned}\ng_0 &: u(c,l) = \\log c_m + \\log l_m + \\log c_f + \\log l_f,\\\\\ng_1 &: w_m (1 - l_m) + w_f (1 - l_f) - c_m - c_f \\ge 0,\\\\\ng_2 &: 1 - l_m \\ge 0,\\quad g_3 : 1 - l_f \\ge 0,\\\\\ng_4 &: c_m \\ge 0,\\quad g_5 : c_f \\ge 0,\\\\\ng_6 &: l_m \\ge 0,\\quad g_7 : l_f \\ge 0.\n\\end{aligned}\n\\]\nとして制約付き最適化問題\n\\[\n\\max_x g_0(x) \\quad \\text{s.t.} \\quad g_j(x) \\ge 0, \\quad j = 1, \\dots, J\n\\] を考えます。このとき、最適解候補 (x^*) が内点解 であるとは、 すべての不等式制約が厳密に成立している（binding していない）こと、すなわち\n\\[\ng_j(x^*) &gt; 0 \\quad \\forall j = 1, \\dots, J\n\\] が成り立つ場合をいいます。もし \\(x^{*}\\) が内点解であるならば、 すべての不等式制約は厳密に満たされます \\((g_j(x^*) &gt; 0)\\)。\nしたがって、相補スラック条件より \\(\\lambda_j = 0 \\forall j \\ge 1\\)。 これをFJ条件に代入すると：\n\\[\n\\lambda_0 \\nabla g_0(x^*) = 0 \\quad \\Rightarrow \\quad \\nabla g_0(x^*) = 0\n\\] （ただし $_0 $)\n制約のうち、余暇 \\(l_m, l_f\\) に関するものは\n\\[\n0 \\le l_m \\le 1, \\quad 0 \\le l_f \\le 1,\n\\]\nすなわち\n\\[\ng_2 = 1 - l_m \\ge 0, \\quad g_3 = 1 - l_f \\ge 0, \\quad\ng_6 = l_m \\ge 0, \\quad g_7 = l_f \\ge 0.\n\\]\nしたがって、内点解では \\[\ng_j(x^*) &gt; 0 \\ \\forall j \\quad \\Rightarrow \\quad\n0 &lt; l_m^* &lt; 1, \\quad 0 &lt; l_f^* &lt; 1.\n\\]\nこれを満たさない場合（例：\\(l_m = 1\\) や \\(l_f = 1\\)）は、少なくとも1つの制約が等号で成立しているため、 端点解 となる。\n\n\n\n\\(l_m = 1 \\Rightarrow g_2 = 1 - l_m = 0\\) および \\(l_f = 1 \\Rightarrow g_3 = 1 - l_f = 0\\) では制約が binding。\nしたがって、$l_m = 1 l_f = 1 $ の場合は内点条件 $g_j(x^*) &gt; 0 $ を満たさないため、内点解ではないことがわかります。\n\n\n\n\nLemma 1 内点解におけるFJ条件\nもし \\(x^*\\) が内点解、すなわち\n\\[\ng_j(x^*) &gt; 0 \\quad \\text{for all } j \\in J\n\\]\nを満たすならば、Fritz–John 条件は次を含意する：\n\\[\n\\nabla g_0(x^*) = 0.\n\\]\n\n\n\n\n\n\n\nTip証明\n\n\n\n\n\n\nProof. \\(x^*\\) が内点であるので、すべての不等式制約は厳密に満たされている：\n\\[\ng_j(x^*) &gt; 0 \\quad \\forall j \\in J.\n\\]\nFritz–John 定理の相補スラック条件より、\n\\[\n\\lambda_j g_j(x^*) = 0 \\quad \\forall j \\ge 1.\n\\]\nここで \\(g_j(x^*) &gt; 0\\) であるため、\n\\[\n\\lambda_j = 0 \\quad \\forall j \\ge 1\n\\]\nが成り立つ。 これを Fritz–John の1階条件に代入すると、\n\\[\n\\lambda_0 \\nabla g_0(x^*) = 0\n\\]\nを得る。 さらに、\\((\\lambda_0, \\lambda_1, \\dots, \\lambda_J)\\) が零ベクトルではないことから \\(\\lambda_0 \\ne 0\\) が成立する。\nしたがって両辺を \\(\\lambda_0\\) で割ることで、\n\\[\n\\nabla g_0(x^*) = 0\n\\]\nを得る。\n\n\n\n\n上の補題 Lemma 1　は、内点解においてはラグランジュ乗数がすべてゼロとなり、\n問題が制約なし最適化問題に帰着することを示しています。\nすなわち、「制約がbindingしていない＝緩い（slack）」場合、\n最適化の一階条件は単純に\n\\[\n\\nabla g_0(x^*) = 0\n\\]\nで与えられることがわかりました。\n\n\n\nここでは補題 Lemma 1 の結論（内点では \\(\\nabla g_0(x^*)=0\\)）を用いて、内点解の解析解を求めます。\n内点では不等式制約の乗数はすべて \\(0\\)、したがって FJ の停留条件は \\[\n\\nabla g_0(x^*)=\\mathbf{0}\n\\quad\\Longleftrightarrow\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial c_m}=0,\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial c_f}=0,\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial l_m}=0,\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial l_f}=0.\n\\]\nこれより \\[\n\\frac{1}{c_m}=\\lambda,\\quad\n\\frac{1}{c_f}=\\lambda\n\\ \\Rightarrow\\\nc_m=c_f=\\frac{1}{\\lambda},\n\\] \\[\n\\frac{1}{l_m}=\\lambda w_m\n\\ \\Rightarrow\\\nl_m=\\frac{1}{\\lambda w_m},\\qquad\n\\frac{1}{l_f}=\\lambda w_f\n\\ \\Rightarrow\\\nl_f=\\frac{1}{\\lambda w_f}.\n\\]\n等式制約に代入して \\(\\lambda\\) を決定：\n\\[\n\\frac{2}{\\lambda}\n=w_m\\!\\left(1-\\frac{1}{\\lambda w_m}\\right)\n+w_f\\!\\left(1-\\frac{1}{\\lambda w_f}\\right)\n=(w_m+w_f)-\\frac{2}{\\lambda}\n\\ \\Longrightarrow\\\n\\lambda=\\frac{4}{w_m+w_f}.\n\\]\nよって内点解の候補は\n\\[\n\\boxed{\n\\;\nc_m^*=c_f^*=\\frac{w_m+w_f}{4},\\quad\nl_m^*=\\frac{w_m+w_f}{4w_m},\\quad\nl_f^*=\\frac{w_m+w_f}{4w_f}\\;\n}\n\\]\n\n\n\n\n\n\nTip検算（等式制約）\n\n\n\n\n\n\\[\nc_m^*+c_f^*=\\frac{w_m+w_f}{2},\n\\] \\[\nw_m(1-l_m^*)+w_f(1-l_f^*)\n=w_m\\!\\left(1-\\frac{w_m+w_f}{4w_m}\\right)\n+w_f\\!\\left(1-\\frac{w_m+w_f}{4w_f}\\right)\n=\\frac{w_m+w_f}{2}.\n\\] 両辺が一致。\n\n\n\n\n\n\n\n\n\nTip補足：必要条件（FJ条件）の使い方\n\n\n\n\n\n（出典：宮川(2022)\n（以下、内容は第3節「必要条件の使い方」に基づく要約）\n\n\n必要条件の使い道は消去法である。\n必要条件を満たさないものは解ではないので，すべて除外してよい。\n必要条件を満たす点だけに集中すればよい。\nFJ条件は「微分したものがゼロ」というシャープな条件なので、\n通常はほとんどの候補が消去され、残るのはごく少数である。\n典型的な効用最大化問題では、残る候補が1つだけになることが多い。\n残りが1つだけであれば、それ以外はすべて解でないので、\nもし解が存在するなら、その1つが解であると結論できる。\n\n\n\n残り1つの候補が真の解であるためには、まず解の存在を確認する必要がある。\n存在の証明には、非線形計画法よりも一般的なワイエルシュトラスの定理を使うのが定石である。\nワイエルシュトラスの定理\n&gt; \\(f : X \\to \\mathbb{R}\\) が連続関数で，\n&gt; \\(X \\subset \\mathbb{R}^n\\) が有界かつ閉（コンパクト）で非空なら，\n&gt; \\(X\\) 内に \\(f\\) を最大にする点が存在する。\n標準的な消費者問題では，予算集合が有界かつ閉であり，\n効用関数が連続（微分可能）なので，この定理を適用できる。\nしたがって，効用最大化問題の解の存在が保証される。\n\n\n\nワイエルシュトラス定理などにより解の存在が保証され，\nFJ条件によって \\(x\\) が1つに絞れたなら，その \\(x\\) は最適解である。\n他の点はすでに消去済みなので，それ以外に解は存在しない。\nこのとき、必要条件（十分条件ではない）を使いながらも、\n解の存在と組み合わせることで唯一解を特定できる。\n\n\n\nもしFJ条件で解候補が複数残った場合でも、\n残りの候補が少数ならば、それらの間で目的関数 \\(g_0(x)\\) の値を比較すればよい。\n残った中で \\(g_0(x)\\) が最大の点が最適解である。\nすでに存在が保証されているなら、その点が唯一の最適解と断定できる。\n要するに：\n\n必要条件は「最適解を直接求める」ためではなく、\n「最適でないものを排除する」ための道具である。\n凹最適化や消費者問題のように、候補が1つに絞れる状況では、\n必要条件＋存在定理だけで最適解を完全に特定できる。\n\n\n\n\n\n\n\n\nここでは，先ほど求めた内点候補が真の最適解であることを示します：\n\nTheorem 2 アロー＝エントーベン定理（Arrow and Enthoven, 19613\n最大化問題\n\\[\n\\max_x g_0(x) \\quad \\text{s.t. } g_j(x) \\ge 0, \\; j=1,\\ldots,J\n\\]\nにおいて、各 \\(g_j\\) が準凹関数で \\(x\\) において微分可能であるとする。\nもし \\(x\\) が Fritz–John 条件と \\(\\lambda_0&gt;0\\) を満たす \\(\\lambda\\) を伴い、かつ\n\\[\n\\nabla g_0(x) \\ne 0\n\\]\nが成立するならば、\\(x\\) は最大化問題の解である。\n\n\n\n最適化問題は\n\\[\n\\max_{c_m,c_f,l_m,l_f}\\; g_0(x)=\\log c_m+\\log l_m+\\log c_f+\\log l_f\n\\quad\\text{s.t.}\\quad\n\\begin{cases}\ng_1(x)=w_m(1-l_m)+w_f(1-l_f)-c_m-c_f\\ \\ge 0,\\\\\n0\\le l_m\\le 1,\\quad 0\\le l_f\\le 1,\\quad c_m\\ge 0,\\ c_f\\ge 0.\n\\end{cases}\n\\]\nでした。\n\n準凹性・微分可能性：\\(g_0\\) は厳密凹（⇒ 準凹）で，\\(g_1\\)・上下界制約はいずれもアフィン（⇒ 準凹），いずれも候補点で微分可能。\n\nFJ（KKT）成立：予算は 局所非飽和性の下で等号（\\(g_1(x^*)=0\\)）となり，他の不等式は厳密不等号（\\(0&lt;l_i^*&lt;1\\), \\(c_i^*&gt;0\\)）。よって相補スラックより \\(\\lambda_1\\ge 0\\), 他の乗数は \\(0\\)，さらに \\(\\lambda_0&gt;0\\)（KKT形）。\n\n勾配がゼロでない：\\(x^*\\) で \\[\n\\nabla g_0(x^*)=\\left(\\tfrac{1}{c_m^*},\\,\\tfrac{1}{l_m^*},\\,\\tfrac{1}{c_f^*},\\,\\tfrac{1}{l_f^*}\\right)\\neq 0.\n\\] が成立します。\n\n\n\n\n以上より、先ほど求めた内点候補は，アロー＝エントーベンの十分条件をすべて満たします。したがって、内点解候補\n\\[\n\\boxed{\n\\begin{align}\nc_m^*=c_f^* & =\\frac{w_m+w_f}{4},\\\\\nl_m^* & =\\frac{w_m+w_f}{4w_m},\\\\\nl_f^* & =\\frac{w_m+w_f}{4w_f}\n\\end{align}\n}\n\\]\nは最適解です。\n\n\n\n内点では \\(0&lt;l_m^*,l_f^*&lt;1\\) が必要です。上式より \\[\n\\begin{align}\n\\frac{w_m+w_f}{4w_m}&lt;1 & \\Longleftrightarrow & \\frac{w_f}{w_m}&lt;3, \\\\\n\\frac{w_m+w_f}{4w_f}&lt;1 & \\Longleftrightarrow & \\frac{w_m}{w_f}&lt;3.\n\\end{align}\n\\]\nしたがって \\[\n\\frac{1}{3}&lt;\\frac{w_m}{w_f}&lt;3\n\\] のとき、上の内点解が実現します。\nこの条件を満たさない場合、すなわち\n\\[\n\\begin{align}\n\\frac{w_m}{w_f}\\ge 3 & \\Longrightarrow & l_f^*\\ge 1 \\\\\n\\frac{w_m}{w_f}\\le \\frac{1}{3} & \\Longrightarrow & l_m^*\\ge 1\n\\end{align}\n\\]\nとなり内点解である条件を満たしません。このときの端点解を以下で別途で検証していきます。\n\n\n\n\n以下ではFJ条件を用いて、以下の3つの端点ケースが最適性の必要条件を満たすかを確認していきます。\\(c_{i}, i \\in \\{m, f\\}\\)については内点解を仮定します。\n\\[\n\\begin{aligned}\nl_m = 1,　& 0 &lt; l_f &lt; 1 & \\text{(ケース A)} \\\\\n0 &lt; l_m &lt; 1,　& l_f = 1 & \\text{(ケース B)} \\\\\nl_m = 1,　& l_f = 1 & \\text{(ケース C)}\n\\end{aligned}\n\\]\n以下では次の命題4を使います。\n\nProposition 1 すべての不等式制約がアフィンなら、FJ条件に \\(\\lambda_0&gt;0\\) を追加できる。\n\n\n\n\n\n\n\nTip証明\n\n\n\n\n\n\nProof. 証明は宮川(2022)の補足資料を参照。\n\n\n\n\n\n\n相補スラックより \\(1-l_m=0 \\Rightarrow \\lambda_2\\ge0\\)（他は slack）。FJ の1階条件は：\n\\[\n\\begin{align}\n\\frac{1}{c_m}=\\lambda_1, \\quad \\frac{1}{c_f}=\\lambda_1 & \\Rightarrow & c_m=c_f=\\frac{1}{\\lambda_1}. \\\\\n\\frac{1}{l_f}-\\lambda_1 w_f=0 & \\Rightarrow & l_f=\\frac{1}{\\lambda_1 w_f}, \\\\\n\\underbrace{\\frac{1}{l_m}}_{=1}-\\lambda_1 w_m-\\lambda_2=0 & \\Rightarrow & \\lambda_2=1-\\lambda_1 w_m \\ge 0.\n\\end{align}\n\\]\n予算制約式より、 \\[\n\\frac{2}{\\lambda_1}=w_f \\left(1-\\frac{1}{\\lambda_1 w_f}\\right) \\Longrightarrow \\lambda_1=\\frac{3}{w_f}.\n\\]\nしたがって \\[\n\\begin{align}\nc_m^*=c_f^* & =\\frac{w_f}{3},\\\\\nl_f^* & =\\frac{1}{3},\\\\\nl_m^* & =1.\n\\end{align}\n\\]\n成立条件は： \\[\n\\lambda_2=1-\\frac{3w_m}{w_f}\\ge 0 \\Longleftrightarrow \\frac{w_m}{w_f}\\le\\frac{1}{3}.\n\\]\n\n\n\nケースAと同様の計算で\n\\[\n\\begin{align}\n\\lambda_1 & =\\frac{3}{w_m},\\\\\nc_m^*=c_f^* & =\\frac{w_m}{3},\\\\\nl_m^* & =\\frac{1}{3},\\\\\nl_f^* & =1,\n\\end{align}\n\\] 成立条件は：\n\\[\n\\lambda_3 =1-\\frac{3w_f}{w_m}\\ge 0 \\Longleftrightarrow \\frac{w_m}{w_f}\\ge 3.\n\\]\n\n\n\n賃金所得が 0 で予算 \\(c_m+c_f=0\\)。非負制約より \\(c_m=c_f=0\\) だが \\(\\log 0=-\\infty\\)。\n微小な調整（どちらかが僅かに働く・消費を正にする）で効用が改善できるため、最適解になり得ないことがわかります。\n以上より、端点解でFJ条件を満たすものは\n\\[\n\\boxed{\n\\begin{align}\nc_m^*=c_f^* & =\\frac{w_f}{3},\\\\\nl_f^* & =\\frac{1}{3},\\\\\nl_m^* & =1.\n\\end{align}\n}\n\\]\nおよび\n\\[\n\\boxed{\n\\begin{align}\n\\lambda_1 & =\\frac{3}{w_m},\\\\\nc_m^*=c_f^* & =\\frac{w_m}{3},\\\\\nl_m^* & =\\frac{1}{3},\\\\\nl_f^* & =1,\n\\end{align}\n}\n\\]\nとなります。アロー＝エントーベンの定理　(Theorem 2)　よりこれらは最適解の十分条件を満たします。\n\n\n\n\n\n以上の結果より、\\(\\gamma_c = \\gamma_l = 1\\)、すなわち \\(u(c,l) = \\log c + \\log l\\) としたときの最適化問題に対する \\(c_m, c_f, l_m, l_f\\) の解析解は\n\n\n\\[\n\\begin{align}\nc_m^* = c_f^* &= \\frac{w_m + w_f}{4},\\\\\nl_m^* &= \\frac{w_m + w_f}{4w_m},\\\\\nl_f^* &= \\frac{w_m + w_f}{4w_f}.\n\\end{align}\n\\]\n\n\n\n\\[\n\\begin{align}\nc_m^* = c_f^* &= \\frac{w_f}{3},\\\\\nl_f^* &= \\frac{1}{3},\\\\\nl_m^* &= 1.\n\\end{align}\n\\]\n\n\n\n\n\n\\[\n\\begin{align}\n\\lambda_1 &= \\frac{3}{w_m},\\\\\nc_m^* = c_f^* &= \\frac{w_m}{3},\\\\\nl_m^* &= \\frac{1}{3},\\\\\nl_f^* &= 1.\n\\end{align}\n\\]\nの3パターンとなります。すなわち、夫婦の賃金比 \\(w_m/w_f\\) に応じて内点解、端点解A、端点解Bの3つに決まります。\n\n\n\n\n\\(w_m, w_f\\) を所与とした，\\(\\gamma_c, \\gamma_l \\ne 1\\) のときに数値解を求める関数をプログラムせよ。\n\\(w_m = 1.0\\) とし，\\(w_f \\in [0.1, 1.0]\\) の範囲の値を取るときの\n\\(c_m, c_f, l_m, l_f\\) の値をプロットせよ。\nこの時，数値解の正しさを確認するために，\\(\\gamma_c = \\gamma_l = 0.95\\) の場合と\n\\(\\gamma_c = \\gamma_l = 1.05\\) の場合の数値解を上で求めた解析解（\\(\\gamma_c = \\gamma_l = 1\\)）の三つをプロットせよ。\n\n\n先程までは \\(\\gamma_c = \\gamma_l = 1\\)　の場合の解析解を求めましたが、今回はCRRA効用において \\(\\gamma_c, \\gamma_l \\ne 1\\) の時の最大解を数値計算によって求めます。\n\n\n簡単に書きます。\n効用関数を一般のCRRA型（\\(\\gamma_c, \\gamma_l \\ne 1\\)）として先程の問1.1と同じ手順を踏んでいきます。\n\\[\nu(c,l) = \\frac{c^{1 - \\gamma_c} - 1}{1 - \\gamma_c}\n+ \\frac{l^{1 - \\gamma_l} - 1}{1 - \\gamma_l}.\n\\]\n与えられた賃金 \\(w_m, w_f\\) の下で、次の最大化問題を考えます：\n\\[\n\\max_{c_m, c_f, l_m, l_f} \\; u(c_m, l_m) + u(c_f, l_f)\n\\quad \\text{s.t.} \\quad\nc_m + c_f = w_m (1 - l_m) + w_f (1 - l_f),\n\\]\nただし \\(0 \\le l_m, l_f \\le 1,\\ c_m, c_f \\ge 0\\)。\n\n\n\n\n効用関数 \\(u(c,l)\\) は \\((0,\\infty)\\times(0,1]\\) 上で連続であり、\n制約集合も有界かつ閉であるため（\\(0 \\le l_i \\le 1\\), \\(c_i \\ge 0\\)）、\nよってワイエルシュトラスの定理により最大解の存在が保証されます。\nさらに、\\(u(c,l)\\) は各変数に関して厳密に凹関数であるため、\n制約集合が凸であることから最大解は一意といえます。\n\n\n\n\\(c_i = 0\\) または \\(l_i = 0\\) の場合、\\(u(c,l)\\) の導関数が発散するため、\nこれらの点は最適解ではありえません。\n\n\\(l_i = 0\\) の場合：\\(u_l(c,0) = \\lim_{l \\to 0+} l^{-\\gamma_l} = +\\infty\\)。\n労働を少し減らして余暇を増やすと効用が上がるため、\\(l_i=0\\) は排除されます。\n\\(c_i = 0\\) の場合：\\(u_c(0,l) = \\lim_{c \\to 0+} c^{-\\gamma_c} = +\\infty\\)。\n消費を少し増やすと効用が無限に上昇するため、\\(c_i=0\\) も排除されます。\n\nしたがって、最大解は次の内点領域に存在することになります： \\[\nc_m&gt;0,\\quad c_f&gt;0,\\quad 0&lt;l_m&lt;1,\\quad 0&lt;l_f&lt;1.\n\\]\n\n\n\n上の内点領域では、効用関数および制約式はいずれも滑らかであるため、\nFJ条件をそのまま適用できます。\nラグランジュ関数を定義： \\[\n\\mathcal{L}(c_m, c_f, l_m, l_f, \\lambda)\n= u(c_m, l_m) + u(c_f, l_f)\n+ \\lambda \\big[w_m(1-l_m)+w_f(1-l_f)-c_m-c_f\\big].\n\\]\n1階条件： \\[\n\\begin{aligned}\n\\frac{\\partial \\mathcal{L}}{\\partial c_m} &= c_m^{-\\gamma_c} - \\lambda = 0,\\\\\n\\frac{\\partial \\mathcal{L}}{\\partial c_f} &= c_f^{-\\gamma_c} - \\lambda = 0,\\\\\n\\frac{\\partial \\mathcal{L}}{\\partial l_m} &= l_m^{-\\gamma_l} - \\lambda w_m = 0,\\\\\n\\frac{\\partial \\mathcal{L}}{\\partial l_f} &= l_f^{-\\gamma_l} - \\lambda w_f = 0.\n\\end{aligned}\n\\]\nここから、 \\[\nc_m = c_f = \\lambda^{-1/\\gamma_c}, \\qquad\nl_m = (\\lambda w_m)^{-1/\\gamma_l}, \\quad\nl_f = (\\lambda w_f)^{-1/\\gamma_l}.\n\\]\nしたがって、 \\[\n\\begin{align}\n\\lambda & = \\frac{l_f^{-\\gamma_l}}{w_f} \\\\\nc_m=c_f & =\\lambda^{-1/\\gamma_c}=w_f^{1/\\gamma_c}\\, l_f^{\\gamma_l/\\gamma_c},\n\\end{align}\n\\]\n\\[\n\\begin{align}\nl_m & =(\\lambda w_m)^{-1/\\gamma_l} \\\\\n& = \\Big(\\tfrac{w_m}{w_f}\\,l_f^{-\\gamma_l}\\Big)^{-1/\\gamma_l} \\\\\n& =\\Big(\\tfrac{w_f}{w_m}\\Big)^{1/\\gamma_l}\\, l_f.\n\\end{align}\n\\]\nこれを予算制約式 \\(c_m+c_f=w_m(1-l_m)+w_f(1-l_f)\\) に代入すると，\n\\[\n\\boxed{\n2\\,w_f^{1/\\gamma_c}\\,l_f^{\\gamma_l/\\gamma_c}\n+\\Big[w_m\\Big(\\tfrac{w_f}{w_m}\\Big)^{1/\\gamma_l}+w_f\\Big]\\,l_f\n-\\,(w_m+w_f)=0\n}\n\\]\nこの方程式を数値的に解き、\\(l_f\\) の最大解をもとめることでその他の \\((c_m, c_f, l_m)\\) が求まります。\n\n\n内点解は\n\\[\n0 &lt; l_m &lt; 1, \\quad 0 &lt; l_f &lt; 1\n\\]\nが成立する解のことでした。下限側（\\(l_i&gt;0\\), \\(c_i&gt;0\\)）については、そうでない場合は上で述べたように最適解とはなりえないことが分かっているので、上限側の条件（\\(l_i&lt;1\\)）のみを確認すればよいことになります。 一階条件より \\[\nl_i = (\\lambda w_i)^{-1/\\gamma_l}, \\quad i \\in \\{m, f\\}.\n\\]\nしたがって、 \\[\nl_i &lt; 1\n\\iff\n\\lambda w_i &gt; 1.\n\\]\nここで \\(w_m &gt; w_f\\) の場合、\\(\\lambda w_f &gt; 1\\) を満たせば自動的に \\(\\lambda w_m &gt; 1\\) も満たされます。\nよって、内点解の可否は次のようにまとめられます：\n\\[\n\\boxed{\n\\lambda w_f &gt; 1\n\\longrightarrow 0 &lt; l_f &lt; (w_m/w_f)^{1/\\gamma_l}\n}\n\\]\n\n\n\n\n\n最適化の条件式は:\n\\[\n\\begin{align}\nl_f & =1, \\\\\nl_m & =(\\lambda w_m)^{-1/\\gamma_l}, \\\\\nc_m=c_f & =\\lambda^{-1/\\gamma_c}.\n\\end{align}\n\\]\n\\(\\lambda=\\dfrac{l_m^{-\\gamma_l}}{w_m}\\) を用い、予算制約\n\\[\nc_m+c_f=w_m(1-l_m)\n\\] に代入すると、 \\[\n2 w_m^{1/\\gamma_c} l_m^{\\gamma_l/\\gamma_c}+w_m l_m- w_m =0.\n\\]\n可否条件 \\[\n\\lambda w_f \\le 1 \\Longleftrightarrow\\ \\Big(\\tfrac{w_f}{w_m}\\Big) l_m^{-\\gamma_l}\\le 1\n\\Longleftrightarrow l_m \\ge \\Big(\\tfrac{w_f}{w_m}\\Big)^{1/\\gamma_l},\n\\]\n\n\n\n\n\nこの場合は \\(l_f=1\\) なので、端点Aと対称に \\(l_m\\) について\n\\[\n\\begin{align}\nl_m & =1, \\\\\nl_f & =(\\lambda w_f)^{-1/\\gamma_l}, \\\\\nc_m=c_f & =\\lambda^{-1/\\gamma_c}.\n\\end{align}\n\\]\n\\(\\lambda=\\dfrac{l_f^{-\\gamma_l}}{w_f}\\) を用い、予算制約 ( c_m+c_f=w_f(1-l_f) ) に代入すると， \\[\n2 w_f^{1/\\gamma_c} l_f^{\\gamma_l/\\gamma_c} + w_f l_f-w_f=0.\n\\]\n可否条件 \\[\n\\lambda w_m \\le 1 \\Longleftrightarrow \\Big(\\tfrac{w_m}{w_f}\\Big) l_f^{-\\gamma_l}\\le 1\n\\Longleftrightarrow l_f \\ge \\Big(\\tfrac{w_m}{w_f}\\Big)^{1/\\gamma_l},\n\\]\n\n\n\\[\nc_m + c_f = 0\n\\]\n予算式から上式が成立します。\nところが、非負制約より \\(c_m, c_f \\ge 0\\) なので\n\\[\nc_m = c_f = 0.\n\\]\nCRRA 型効用の限界効用は \\(c_i \\to 0\\) のとき発散し、\nすなわち\n\\[\n\\lim_{c_i \\to 0} u(c_i, l_i)\n= \\frac{c_i^{1-\\gamma_c} - 1}{1-\\gamma_c}\n\\to -\\infty.\n\\]\nしたがって，この場合の効用は\n\\[\nu(c_m, l_m) + u(c_f, l_f) \\to -\\infty,\n\\]\nとなり，わずかでも消費や余暇を増やすことで効用が改善できます。\nゆえに Corner C（\\(l_m=1,\\ l_f=1\\)）は最適解になり得ない（除外）ことがわかります。\n\n\n\n\n\n\n以下の結果を出すために数値コードが実行している処理を、アルゴリズムとして整理して説明します。\n\n\nアルゴリズムはまず、夫婦の労働供給が「内点解」になるか「端点解」になるかを判定します。\n\n女性の労働を未知変数として扱い、男性の労働は一階条件から\n\\[\nl_m = \\left(\\frac{w_f}{w_m}\\right)^{1/\\gamma_l} l_f\n\\]\nで決定します。\nこの関係と予算制約に基づいて導出した方程式\n\\[\nf(l_f)=2 w_f^{1/\\gamma_c} l_f^{\\gamma_l/\\gamma_c}+w_f l_f- w_f =0.\n\\] を使います。\n区間 (\\(0,1\\)) の端点付近で\n\\[\nf(0+\\varepsilon)\\cdot f(1-\\varepsilon) &lt; 0\n\\] が成り立つ場合、内点に根が存在し、内点解が成立します。\n成り立たない場合は端点解となり、女性が完全に労働する\n\\[\nl_f = 1\n\\] という条件のもとで、男性の労働を別の方程式\n\\[\nf_B(l_m)=2 w_m^{1/\\gamma_c} l_m^{\\gamma_l/\\gamma_c}+w_m l_m- w_m =0\n\\] により求めます。\n\n\n\n\n内点解が成立した場合、以下の処理を行います。\n\n女性の労働供給 \\(l_f\\) を区間 \\((0,1)\\) 内で数値的に求めます。\n男性の労働供給は \\[\nl_m = \\left(\\frac{w_f}{w_m}\\right)^{1/\\gamma_l} l_f\n\\] により計算します。\n\n\n\n\n内点に解が存在しない場合は、端点解として\n\n女性は完全に労働：\\(l_f = 1\\)\n男性については方程式 \\(f_B(l_m)=0\\) を数値的に解く\n\nという手順で求めます。\n\n\n\n総所得\n\\[\nc_m+c_f= w_m(1-l_m) + w_f(1-l_f)\n\\] より \\[\nc_m = c_f = \\frac{[w_m(1-l_m) + w_f(1-l_f)]}{2}\n\\] を得ます。\n\n\n\n\n\n\nsolve_bargaining (generic function with 1 method)\n\n\n\n\n\nSolutions of bargaining problem. \\(w_m = 1.0, w_f \\in [0.1, 1.0], \\gamma_c = \\gamma_l = 1.5\\).\n\n\n\n\nanalytical_solution (generic function with 1 method)\n\n\n\n\n\nSolutions of bargaining problem. _c = _l = 0.95 1.00 1.05$.\n\n\n\n\n\n\n\nガウス・エルミート求積を用いて、\\(l_m, l_f\\) の期待値を求めよ。その際、 \\(\\mu_m = 0, \\mu_f = -0.2, \\sigma_m = \\sigma_f = 1.0, \\rho = 0.7\\) とする。 効用関数は \\(\\gamma_c = \\gamma_l = 1\\) とする（そのため、問1.1の結果を用いれば良い）。 また、結果を \\(N = 10^6\\) 程度のモンテカルロ法と比較せよ。\n\n\n平均 \\(\\mu\\)、分散共分散行列 \\(\\Sigma\\) の多変量正規分布のガウス・ヘルミート求積は以下のように導出できる。 \\(z = \\frac{1}{\\sqrt{2}}L^{-1}(x - \\mu)\\) として、\n\\[\n\\begin{align}\nS &= \\int v(\\exp(x)) \\, dF(x) \\\\\n  &= \\int v(\\exp(x))\n     \\frac{1}{\\sqrt{\\det(2\\pi\\Sigma)}}\n     \\exp\\!\\left(\n       -\\frac{1}{2}(x - \\mu)^\\top \\Sigma^{-1}(x - \\mu)\n     \\right) dz \\\\[1em]\n  &= \\int\n     v\\!\\left(\\exp(\\mu + \\sqrt{2}Lz)\\right)\n     \\pi^{-\\frac{N}{2}}\n     \\exp(-z^\\top z)\n     v\\!\\left(\\mu + \\sqrt{2}Lz\\right)\n     dz \\\\[1em]\n  &= \\int\n     v\\!\\left(\\exp(\\mu + \\sqrt{2}Lz)\\right)\n     \\pi^{-\\frac{N}{2}}\n     \\exp\\!\\left(\n       -\\sum_{n=1}^{N} z_n^2\n     \\right) dz \\\\[1em]\n  &\\approx\n     \\sum_i \\sum_j\n     \\theta_i \\theta_j \\pi^{-1}\n     v\\!\\left(\n       \\exp\\!\\left(\n         \\mu + \\sqrt{2}L(z_i, z_j)^\\top\n       \\right)\n     \\right)\n\\end{align}\n\\]\nここで、\\(L\\) は \\(\\Sigma\\) のコレスキー分解であり、 \\(LL^\\top = \\Sigma\\) を満たす行列である。\n\n\n\n\n\n計算の考え方（流れの概要）\n\n分布の設定\n夫婦の対数賃金 \\((\\log w_m, \\log w_f)\\) が平均 \\(\\mu=(\\mu_m,\\mu_f)\\)、共分散行列 \\(\\Sigma\\) に従うと仮定。\n賃金の従う分布関数の近似\n賃金の従う分布関数を、ガウス・エルミート求積 (Gauss–Hermite Quadrature) によって近似。\n節点と重みの生成\nFastGaussQuadrature.gausshermite() により節点 \\((z_i)\\) と重み \\((θ_i)\\) を得る。\n相関を導入した変換\n標準正規分布から共分散 \\(\\Sigma\\) をもつ分布へ変換する： \\[\nx = \\mu + \\sqrt{2}\\,Lz, \\quad L = \\text{chol}(\\Sigma)\n\\] そして \\(w = \\exp(x)\\) により賃金水準へ写像する。\n各節点で最適化を実行\n各 \\((w_m, w_f)\\) に対して、solve_bargaining() 関数を使い、夫婦の効用最大化問題を解いて \\[(c_m, c_f, l_m, l_f)\\] を得る。\n重み付き平均の計算\n各節点の結果を重み \\((θ_iθ_j)/π\\) で加重平均して期待値を求める： \\[\nE[l_m] \\approx \\sum_i\\sum_j \\frac{θ_i θ_j}{π} l_m(w_m, w_f)\n\\] \\(l_f\\)についても同様。\nモンテカルロ法との比較\n最後に、乱数サンプリング（\\(N=10^6\\)）による平均値と比較して、精度を確認する。\n\n\n\n問題文より、夫婦の対数賃金 \\(\\log(w_m), \\log(w_f)\\) は次の2次元正規分布に従うと仮定されています：\n\\[\n\\begin{pmatrix} \\log w_m \\\\ \\log w_f \\end{pmatrix}\n\\sim \\mathcal{N}\\left(\n\\begin{pmatrix} \\mu_m \\\\ \\mu_f \\end{pmatrix},\n\\begin{pmatrix}\n\\sigma_m^2 & \\rho\\sigma_m\\sigma_f \\\\\n\\rho\\sigma_m\\sigma_f & \\sigma_f^2\n\\end{pmatrix}\n\\right)\n\\]\n求めたいのは、最適労働時間 \\((l_m, l_f)\\) の期待値：\n\\[\n\\begin{align}\n\\mathbb{E}[l_m] & = \\iint l_m(w_m, w_f) f(w_m, w_f)\\,dw_m\\,dw_f\n\\mathbb{E}[l_f] & = \\iint l_f(w_m, w_f) f(w_m, w_f)\\,dw_m\\,dw_f\n\\end{align}\n\\]\nです。\n\n\n\nこの積分を直接解くのは困難なので、ガウス・エルミート求積を用いて次のように近似していきます：\n\\[\n\\mathbb{E}[l_m] \\approx\n\\sum_{i=1}^N \\sum_{j=1}^N\n\\theta_i \\theta_j \\frac{1}{\\pi}\\,\nl_m\\big(\\exp(\\mu + \\sqrt{2}Lz_{ij})\\big)\n\\]\nここで：\n\n\\((z_i, \\theta_i)\\)：1次元 Gauss–Hermite の節点と重み\n\n\\(L\\)：\\(\\Sigma\\) のコレスキー分解（\\(\\Sigma = LL^\\top\\)）\n\n\\(x = \\mu + \\sqrt{2}Lz\\) により標準正規から共分散 \\(\\Sigma\\) へ変換\n\n\\(\\exp(x)\\) により対数賃金から実際の賃金へ変換\n\nガウス・エルミート求積で何をやるかといえば、\\(w_m, w_f\\)　の従う２次元正規分布をいくつかの点で近似することです。Julia では、そのために標準ライブラリ FastGaussQuadrature.jl というパッケージの gausshermite(n) 関数を使うことができます。\n\n\n\n\n\n\nTip\\(w_m, w_f\\)　の従う２次元正規分布\n\n\n\n\n\n\\[\n\\log\n\\begin{pmatrix}\nw_m \\\\ w_f\n\\end{pmatrix}\n\\sim\n\\mathcal{N}\\!\\left(\n\\begin{pmatrix}\n\\mu_m \\\\ \\mu_f\n\\end{pmatrix},\n\\begin{pmatrix}\n\\sigma_m^2 & \\rho \\sigma_m \\sigma_f \\\\\n\\rho \\sigma_m \\sigma_f & \\sigma_f^2\n\\end{pmatrix}\n\\right)\n\\]\nここで： - \\(\\mu_m, \\mu_f\\)：平均\n- \\(\\sigma_m, \\sigma_f\\)：標準偏差\n- \\(\\rho\\)：相関係数（\\(-1 &lt; \\rho &lt; 1\\)）\n上の仮定のもとで、\\((x_m, x_f) = (\\log w_m, \\log w_f)\\) の確率密度関数は次のように表されます：\n\\[\nf(\\log w_m, \\log w_f)\n= \\frac{1}{2\\pi\\sigma_m\\sigma_f\\sqrt{1-\\rho^2}}\n\\exp\\!\\left(\n-\\frac{1}{2(1-\\rho^2)}\n\\Big[\n\\frac{(\\log w_m-\\mu_m)^2}{\\sigma_m^2}\n- 2\\rho\\frac{(\\log w_m-\\mu_m)(\\log w_f-\\mu_f)}{\\sigma_m\\sigma_f}\n+ \\frac{(\\log w_f-\\mu_f)^2}{\\sigma_f^2}\n\\Big]\n\\right)\n\\]\n上の分布は「対数賃金」の分布です。\n実際の賃金 \\((w_m, w_f)\\) の分布に変換するには、ヤコビアン（Jacobian）による補正を行います。\nヤコビアン \\(J = |\\partial(\\log w_m, \\log w_f)/\\partial(w_m, w_f)| = 1/(w_m w_f)\\) を考慮すると、次のようになります：\n\\[\nf(w_m, w_f)\n= \\frac{1}{w_m w_f 2\\pi\\sigma_m\\sigma_f\\sqrt{1-\\rho^2}}\n\\exp\\!\\left(\n-\\frac{1}{2(1-\\rho^2)}\n\\Big[\n\\frac{(\\log w_m-\\mu_m)^2}{\\sigma_m^2}\n- 2\\rho\\frac{(\\log w_m-\\mu_m)(\\log w_f-\\mu_f)}{\\sigma_m\\sigma_f}\n+ \\frac{(\\log w_f-\\mu_f)^2}{\\sigma_f^2}\n\\Big]\n\\right)\n\\]\nこの式が、 &gt; 「\\(\\log w_m, \\log w_f\\) が平均 \\(\\mu\\), 分散共分散 \\(\\Sigma\\) に従うときの、\\((w_m, w_f)\\) の確率密度関数」 です。\nJulia では、Distributions.jl パッケージを用いることで、\nこの2次元正規分布を直接扱うことができます。\n\n\n0.16126050122638444\n\n\n\n\n\n問1.3では、夫婦それぞれの賃金があるので、forループを使ってgausshermite(n) を2次元版に拡張します。\n\n\n\n\n\ngh2d (generic function with 1 method)\n\n\n\n\nsolve_ana (generic function with 1 method)\n\n\n\n\nmean_leisure (generic function with 1 method)\n\n\n\n\n====ガウス・エルミート求積====\n男性の平均余暇 (l_m の期待値) = 0.5135366523292847\n女性の平均余暇 (l_f の期待値) = 0.6116338368206332\n\n\n\n\n\n最後に、乱数サンプリング(\\(N=10^6\\))による平均値と比較して、精度を確認します。\n\n\n====モンテカルロ計算の結果====\n男性の平均余暇 (l_m の期待値) = 0.513376753762486\n女性の平均余暇 (l_f の期待値) = 0.6113967672780644\n\n\n\n\n\n\n\n\nTipガウス・エルミート求積による近似を可視化する\n\n\n\n\n\n\n\n\n\n\nこの図からわかるようにガウス・エルミート求積は重みをうまく設定することで正規分布の分布関数に含まれる積分などの数値的に難しい積分を精度良く近似することができます。\n\n\n\n\n\n\n\n\n\n授業では確率的動学モデルを Value Function Iteration によって解く方法を学んだ。\nここでは Policy Function Iteration (PFI) を用いて同様の問題を解く。\n\n\n\\[\nV(k, z) = \\max_{k'} \\left\\{ u(f(k, z) + (1 - \\delta)k - k') + \\beta \\mathbb{E}[V(k', z') \\mid z] \\right\\}.\n\\]\n生産性 \\(z\\) は以下のような AR(1) 過程に従う：\n\\[\n\\log z' = (1 - \\rho)\\mu + \\rho \\log z + \\sigma \\varepsilon, \\quad \\varepsilon \\sim \\mathcal{N}(0, 1).\n\\]\n関数形とパラメータは以下の通り：\n\n効用関数：\\(u(c) = \\log c\\)\n\n生産関数：\\(f(k, z) = z k^{\\alpha}\\)\n\nパラメータ：\\(\\beta = 0.96\\), \\(\\delta = 0.1\\), \\(\\alpha = 0.36\\)\n\n\\(z\\) は5つのグリッドに離散化し、PFIを用いて次を求める：\n\n政策関数：\\(k' \\coloneqq g(k, z)\\)\n\n価値関数：\\(V(k, z)\\)\n\nこれらをそれぞれの \\(z\\) に対してプロットせよ。\n\n\n離散化されたAR(1)過程を \\(\\Lambda(z, z')\\) と表すと、オイラー方程式は以下のように書ける：\n\\[\nu'(c) = \\beta \\sum_{z'} \\Lambda(z, z') \\, u'(c') \\, [f'(k', z') + (1 - \\delta)].\n\\]\n\n\n\nPFI終了後に \\(V(k, z)\\) を線型方程式で求めるには、次のようにする：\n\n\\(V(k, z)\\) は離散化されたグリッド上の行列\n\\(\\{V_{i_k, i_z}\\}_{i_k=1,\\dots,n_k,\\, i_z=1,\\dots,n_z}\\)\nである。\n\\(\\{V_{i_k, i_z}\\}\\) をベクトル化した \\(V\\) を考える： \\[\nV_{i_k + n_k (i_z - 1)} \\coloneqq V_{i_k, i_z}.\n\\]\nある \\((i_k, i_z)\\) に対して、\\(k_j &lt; g_{i_k, i_z} &lt; k_{j+1}\\) を満たす \\(j \\in \\{1, \\dots, n_k\\}\\) を求める。\n\\((k, z)\\) から \\((k', z')\\) への遷移は、\\(V\\) 上で\n\\(i_k + n_k (i_z - 1)\\) から \\(i_k' + n_k (i_z' - 1)\\) への遷移となる。\n遷移行列 \\(P\\) は以下のように定義され、定義されていない要素は \\(0\\) とする：\n\n\\[\nP_{i_k + n_k(i_z - 1), \\, j + n_k(i_z' - 1)} =\n\\begin{cases}\n\\Lambda_{i_z, i_z'} \\dfrac{k_{j+1} - g_{i_k, i_z}}{k_{j+1} - k_j}, & \\text{if } 1 &lt; j &lt; n_k, \\\\[6pt]\n\\Lambda_{i_z, i_z'}, & \\text{otherwise.}\n\\end{cases}\n\\]\n\\[\nP_{i_k + n_k(i_z - 1), \\, j+1 + n_k(i_z' - 1)} =\n\\begin{cases}\n\\Lambda_{i_z, i_z'} \\dfrac{g_{i_k, i_z} - k_j}{k_{j+1} - k_j}, & \\text{if } 1 &lt; j &lt; n_k, \\\\[6pt]\n\\Lambda_{i_z, i_z'}, & \\text{otherwise.}\n\\end{cases}\n\\]\n\n\n\n\n\n\nこの関数は、対数生産性 \\(y=\\log z\\) が従う AR(1) 過程\n\\[\ny' = (1-\\rho)\\mu + \\rho y + \\sigma \\varepsilon,\\quad \\varepsilon\\sim\\mathcal N(0,1)\n\\]\nを Tauchen (1986) 5 の手法で有限状態マルコフ連鎖に離散化します。\n\n\ntauchen_logz\n\n\n\n\n([0.14638167652140652, 0.3825985840556738, 1.0, 2.6137054387385943, 6.831456120491708], [0.9726680320541624 0.027331967937081036 … 0.0 0.0; 0.004119509412862319 0.980560996618286 … 1.6353585152728556e-12 0.0; … ; 2.80547015409681e-32 1.6353292102262342e-12 … 0.980560996618286 0.004119509412862321; 2.870957534331882e-60 4.699184351669941e-31 … 0.027331967937081043 0.9726680320541624], [0.03605705163302499, 0.23922998597687464, 0.44942592478020055, 0.23922998597687548, 0.03605705163302434])\n\n\n\n\n\n基本パラメータ：\n-   $\\alpha$：資本の所得分配率\n-   $\\beta$：割引因子\n-   $\\delta$：減耗率\n\n資本グリッド k_grid：\n資本の範囲 \\([k_{\\min}, k_{\\max}] = [0.05, 0.5]\\) を \\(n_k=101\\) 点で離散化。\n政策関数や補間の基盤。\n生産性プロセス：\nTauchen法により、AR(1)過程を離散化し、\\(n_z=5\\) の生産性状態 Z と遷移確率行列 Λ を生成。\n政策関数 h：\n行列サイズ \\((n_k, n_z)\\)。各列が特定の生産性状態 \\(z_j\\) に対応し、\\(h(k_i, z_j)\\) は資本 \\(k_i\\)・生産性 \\(z_j\\) における最適消費。\n価値関数 V:\n後で使うために確保\n\n\n\neuler_eq (generic function with 1 method)\n\n\n\n\npfi! (generic function with 1 method)\n\n\nオイラー方程式：\n\\[\nu'(c) = \\eta \\sum_{z'} \\Lambda(z,z') \\, u'(c') \\, [f'(k',z') + 1 - \\delta].\n\\]\n与えられた \\((k,z,c)\\) に対して、この式を満たす \\(c\\) を求めます。 コードの流れは以下の通り：\n\n次期資本の決定：\n\\[\nk' = f(k,z) + (1-\\delta)k - c\n\\]\n次期消費の補間：\n各 \\(z'\\) ごとに現在の政策関数 \\(h(k',z')\\) を線形補間で求める：\n期待値の計算：\nTauchen法で得た遷移確率行列 Λ[iz, izp] を使って期待値をとる： \\[\nE_z′[\\cdot] = \\sum_{z′} Λ(z,z′)[u′(c′)(f′(k′,z′)+1−δ)]\n\\]\n最適な消費を求める：\n\n\n\nbuild_model (generic function with 1 method)\n\n\n各 \\((k,z)\\) におけるオイラー方程式を満たす消費 \\(c\\) を求め、政策関数 \\(h(k,z)\\) を更新。\n手順は以下の通り：\n\n\\(z\\) のループ追加：\n確定的モデルに \\(z\\) のループを追加し、各生産性状態に対して政策更新を行う。\n可行な消費範囲の設定：\n符号チェックによる端点処理： 両端の符号が同じ場合は境界解を採用。そうでなければ find_zero() で根を求める。\n収束判定：\n\\[\n\\max |h_{new} - h| &lt; 10^{-6}\n\\] で終了。収束すれば「Converged」と出力。\n\n\n\nConverged in 29 iterations. sup‖Δh‖=8.583471663714537e-7\n\n\n\n\n\n結果の経済学的意味\nPFI により得られる政策関数は、以下の経済的特徴を再現：\n\n高い生産性 \\(z\\) のとき：\n所得が多く、消費水準も上昇。政策関数 \\(c = h(k,z)\\) は上方シフト。\n低い生産性 \\(z\\) のとき：\n所得が少なく、将来に備えて消費を抑制し、貯蓄を増やす。 政策関数 \\(c = h(k,z)\\) は下方シフト。\n\n\n\n\n\n\ncompute_vf! (generic function with 1 method)\n\n\n\n\nこの関数は、既に収束した消費政策 \\(h(k,z)\\) を所与として、価値関数 \\(V(k,z)\\) を\n一次方程式\n\\[\n(I - \\beta P) \\mathrm{vec}(V) = \\mathrm{vec}(u(h))\n\\]\nから解きます。ここで \\(P\\) は 1期先の状態遷移（\\((k,z) \\to (k',z')\\)）を表す行列です。\n\n\n\n\n\n\n入力：モデル m::Model\n\nグリッドとパラメータ：k_grid, Z（生産性の5グリッド）, Λ（Tauchenで得た遷移確率）, α, β, δ\n既に PFI で収束した政策：h[i_k, i_z] = h(k_i, z_i)（消費政策）\n\n出力：m.V を \\((n_k \\times n_z)\\) 行列として上書き（更新）\n\n\n\n\n\n\\(n_k = \\text{length}(k_{\\text{grid}})\\), \\(n_z = \\text{length}(Z)\\), 総状態数 \\(n = n_k n_z\\)。\n状態インデックスのフラット化：\n\n\\[\n\\text{idx}(i_k,i_z) = i_k + n_k (i_z - 1)\n\\]\nよって \\((k_i, z_j)\\) に対応する 一次元インデックスが 1..n に写像されます。こうしておくとインデックスの管理が楽です。\n\n\n\n各状態 \\((k_i, z_j)\\) で\n\\[\nr[\\text{idx}(i_k, i_z)] = u\\!\\left(h[i_k, i_z]\\right)\n\\]\nを代入。ここで \\(u(c) = \\log c\\)です。\n\n\n\n\n資本のLaw of Motion（消費 \\(c = h(k,z)\\) を使います）：\n\n\\[\ng \\equiv k' = z k^{\\alpha} + (1 - \\delta) k - c\n\\]\nこれは k_grid の定義域に クランプ（端に外れたら端点に吸着）。\n\n資本方向の線形補間（2点分配）\n\nsearchsortedlast(k_grid, g) により \\(g\\) が属する区間 \\([k_j, k_{j+1}]\\) を見つけ、\n\\[\nw_{\\mathrm{hi}} = \\frac{g - k_j}{k_{j+1} - k_j}, \\quad\nw_{\\mathrm{lo}} = 1 - w_{\\mathrm{hi}}\n\\]\nとします。これにより、次期資本が \\(k_j\\) と \\(k_{j+1}\\) にそれぞれ \\(w_{\\mathrm{lo}}, w_{\\mathrm{hi}}\\) で分配されます （区間外なら左端/右端に吸着）。\n\n生産性方向の遷移（Tauchen の \\(\\Lambda\\)）\n\n現在 \\(z = z_{i_z}\\) から次期 \\(z' = z_{i_z'}\\) へは確率 \\(\\Lambda[i_z, i_z']\\)。\nよって、1期先の joint 確率は\n\\[\n\\Pr\\bigl((k',z') = (k_j, z_{i_z'}) \\mid (k,z)\\bigr)\n= \\Lambda[i_z, i_z'] \\times w_{\\mathrm{lo}},\n\\]\n\\[\n\\Pr\\bigl((k',z') = (k_{j+1}, z_{i_z'}) \\mid (k,z)\\bigr)\n= \\Lambda[i_z, i_z'] \\times w_{\\mathrm{hi}}.\n\\]\nこれをフラット化インデックスに落として P[row, col] に加算します。\n\n直感的には、資本の線形補間と 生産性のマルコフ遷移（\\(\\Lambda\\)）を 同時に畳み込んだ行列 \\(P\\) を作っている感じです。\n\n\n\n\n連立一次方程式\n\\[\n(I - \\beta P)\\,V^{\\mathrm{vec}} = r\n\\]\nを直接解きます。得られた Vvec を\n\\[\nV = \\text{reshape}(Vvec, (n_k, n_z))\n\\]\nとして m.V に格納します。\n\n\n\n\n\\(g\\) がグリッド外に出た場合は 端点に吸着（j &lt;= 1 / j &gt;= n_k 分岐）。\n\n\n\n\nValue Function"
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html#解答の方針",
    "href": "notes/Macroiv_assign1_TA.html#解答の方針",
    "title": "Exercise 1: Numerical Methods",
    "section": "",
    "text": "コアコースのミクロ経済学の講義を思い出してみましょう1。\n\n\n最大解を導く一般的な手順は以下の通りです。\n\n最大解が存在することを確認する。\n\n微分不可能な点を排除する。\n\nFJ条件と制約条件を満たす \\((x, \\lambda)\\) の組を求める。\n\n唯一の候補があればそれが最大解。複数ある場合は \\(g_0\\) を比較する。\n\n微分不可能な点がある場合は直接比較で確認する。\n\nFJ条件（Fritz John 条件）は以下の定理により与えられます。\n\nTheorem 1 定理 1（フリッツ・ジョン定理）\n\\(\\hat{x} \\in \\mathbb{R}^n\\) を最大化問題 (P) の解とする。 この \\(\\hat{x}\\) においてすべての \\(g_j\\) が微分可能ならば， \\(\\lambda = (\\lambda_0, \\dots, \\lambda_l) \\in \\mathbb{R}^{l+1}\\) が存在し，\n\\[\n\\begin{aligned}\n\\text{(a)} &\\quad\n\\sum_{j=0}^l \\lambda_j \\frac{\\partial g_j(\\hat{x})}{\\partial x_i} = 0,\n&& \\forall i = 1, \\dots, n \\quad \\text{(1階条件)}\\\\[0.5em]\n\\text{(b)} &\\quad\n\\lambda_j \\ge 0 \\quad \\forall j \\ge 0 && \\text{(非負条件)} \\\\[0.5em]\n\\text{(c)} &\\quad\n\\lambda_j &gt; 0 \\ \\text{for some } j \\ge 0 && \\text{(非ゼロ条件)} \\\\[0.5em]\n\\text{(d)} &\\quad\n\\lambda_j g_j(\\hat{x}) = 0 \\quad \\forall j \\ge 1 && \\text{(相補スラック条件)}\n\\end{aligned}\n\\]\n\n以下ではこのフレームワークに沿って問1に解答していきます。"
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html#問-1.1question-1",
    "href": "notes/Macroiv_assign1_TA.html#問-1.1question-1",
    "title": "Exercise 1: Numerical Methods",
    "section": "",
    "text": "\\(\\gamma_c = \\gamma_l = 1\\)、すなわち \\(u(c,l) = \\log c + \\log l\\) とする。\n\\(w_m, w_f\\) を所与として、\\(c_m, c_f, l_m, l_f\\) の解析解を求めよ。\nただし、\\(l_m = 1\\) または \\(l_f = 1\\) となる端点解にも注意せよ。\n\n\n\n\n効用関数 \\(u(c,l)=\\log c+\\log l\\) は定義域 \\((0,\\infty)\\times(0,1]\\) 上で連続。\n制約集合\n\\[\nc_m + c_f = w_m (1-l_m) + w_f (1-l_f), \\quad\nc_m, c_f \\ge 0, \\quad l_m, l_f \\in [0,1]\n\\]\nは閉かつ有界（コンパクト）なので、ワイエルシュトラスの定理より最大解は存在。\nさらに \\(\\log\\) 関数は厳密に凹であるため、最大解は一意です2。\n\n\n\n制約条件は次の通りです：\n\\[\n\\begin{aligned}\ng_0 &: u(c,l) = \\log c_m + \\log l_m + \\log c_f + \\log l_f,\\\\\ng_1 &: w_m (1 - l_m) + w_f (1 - l_f) - c_m - c_f \\ge 0,\\\\\ng_2 &: 1 - l_m \\ge 0,\\quad g_3 : 1 - l_f \\ge 0,\\\\\ng_4 &: c_m \\ge 0,\\quad g_5 : c_f \\ge 0,\\\\\ng_6 &: l_m \\ge 0,\\quad g_7 : l_f \\ge 0.\n\\end{aligned}\n\\]\n\\(g_1,\\ldots,g_7\\) はアフィンなので全域で微分可能です。\n問題は \\(g_0 = \\log c_m + \\log l_m + \\log c_f + \\log l_f\\) のみです。\n\\(c_i=0\\) または \\(l_i=0\\) の点では \\(\\log 0 = -\\infty\\) のため微分不能となります。\nこれらが最大解にならないことを確認します。\n\n\n\\((c_m, c_f, l_m=0, l_f)\\) を考えます。\n小さい \\(\\varepsilon&gt;0\\) をとり、\\(\\Delta l_m = \\varepsilon\\) だけ余暇を増やすことにします。\nそのぶん労働所得 \\(w_m \\varepsilon\\) 減少させることで消費も \\(\\Delta c_m = -w_m \\varepsilon\\) だけ減らす事が可能です。\n効用差は：\n\\[\nf(\\varepsilon) = u(c_m - w_m \\varepsilon, \\varepsilon, c_f, l_f)\n- u(c_m, 0, c_f, l_f)\n\\]\n微分すると：\n\\[\nf'(0+) = -\\frac{w_m}{c_m} + \\frac{1}{\\varepsilon}\\Big|_{\\varepsilon \\to 0+} = +\\infty\n\\]\nしたがって \\(f(\\varepsilon)&gt;0\\)。\nよって \\(l_m=0\\) は最大解ではありません。同様に \\(l_f=0\\) も排除されます。\n\n\n\n\\((c_m=0, c_f, l_m, l_f)\\) を考えます。\n小さい \\(\\delta&gt;0\\) に対して \\(c_m\\) を \\(\\delta\\) 増やし、その分 \\(c_f\\) を減らす事を考えます：\n\\[\ng(\\delta) = \\log \\delta + \\log(c_f - \\delta) - (\\log 0 + \\log c_f)\n\\]\n微分すると：\n\\[\ng'(0+) = \\frac{1}{\\delta}\\Big|_{\\delta \\to 0+} - \\frac{1}{c_f} = +\\infty\n\\]\nしたがって、\\(c_m=0\\) も最大解ではなく、\\(c_f=0\\) も同様に排除されます。以上より最大解は次の領域に存在することがわかりました：\n\\[\nc_m&gt;0,\\quad c_f&gt;0,\\quad 1\\ge l_m&gt;0,\\quad 1\\ge l_f&gt;0.\n\\]\nこの領域では \\(u(c,l)\\) は滑らかで、FJ条件を適用できます。\n\n\n\n\nここまでで最大解となる候補が \\(c_m&gt;0,\\quad c_f&gt;0,\\quad 1\\ge l_m&gt;0,\\quad 1\\ge l_f&gt;0\\)に存在することがわかりました。 ここからはこの範囲の解が本当に最大解なのかどうかをFJ条件を使って調べていきます。\n\n\n\\[\n\\begin{aligned}\ng_0 &: u(c,l) = \\log c_m + \\log l_m + \\log c_f + \\log l_f,\\\\\ng_1 &: w_m (1 - l_m) + w_f (1 - l_f) - c_m - c_f \\ge 0,\\\\\ng_2 &: 1 - l_m \\ge 0,\\quad g_3 : 1 - l_f \\ge 0,\\\\\ng_4 &: c_m \\ge 0,\\quad g_5 : c_f \\ge 0,\\\\\ng_6 &: l_m \\ge 0,\\quad g_7 : l_f \\ge 0.\n\\end{aligned}\n\\]\nとして制約付き最適化問題\n\\[\n\\max_x g_0(x) \\quad \\text{s.t.} \\quad g_j(x) \\ge 0, \\quad j = 1, \\dots, J\n\\] を考えます。このとき、最適解候補 (x^*) が内点解 であるとは、 すべての不等式制約が厳密に成立している（binding していない）こと、すなわち\n\\[\ng_j(x^*) &gt; 0 \\quad \\forall j = 1, \\dots, J\n\\] が成り立つ場合をいいます。もし \\(x^{*}\\) が内点解であるならば、 すべての不等式制約は厳密に満たされます \\((g_j(x^*) &gt; 0)\\)。\nしたがって、相補スラック条件より \\(\\lambda_j = 0 \\forall j \\ge 1\\)。 これをFJ条件に代入すると：\n\\[\n\\lambda_0 \\nabla g_0(x^*) = 0 \\quad \\Rightarrow \\quad \\nabla g_0(x^*) = 0\n\\] （ただし $_0 $)\n制約のうち、余暇 \\(l_m, l_f\\) に関するものは\n\\[\n0 \\le l_m \\le 1, \\quad 0 \\le l_f \\le 1,\n\\]\nすなわち\n\\[\ng_2 = 1 - l_m \\ge 0, \\quad g_3 = 1 - l_f \\ge 0, \\quad\ng_6 = l_m \\ge 0, \\quad g_7 = l_f \\ge 0.\n\\]\nしたがって、内点解では \\[\ng_j(x^*) &gt; 0 \\ \\forall j \\quad \\Rightarrow \\quad\n0 &lt; l_m^* &lt; 1, \\quad 0 &lt; l_f^* &lt; 1.\n\\]\nこれを満たさない場合（例：\\(l_m = 1\\) や \\(l_f = 1\\)）は、少なくとも1つの制約が等号で成立しているため、 端点解 となる。\n\n\n\n\\(l_m = 1 \\Rightarrow g_2 = 1 - l_m = 0\\) および \\(l_f = 1 \\Rightarrow g_3 = 1 - l_f = 0\\) では制約が binding。\nしたがって、$l_m = 1 l_f = 1 $ の場合は内点条件 $g_j(x^*) &gt; 0 $ を満たさないため、内点解ではないことがわかります。\n\n\n\n\nLemma 1 内点解におけるFJ条件\nもし \\(x^*\\) が内点解、すなわち\n\\[\ng_j(x^*) &gt; 0 \\quad \\text{for all } j \\in J\n\\]\nを満たすならば、Fritz–John 条件は次を含意する：\n\\[\n\\nabla g_0(x^*) = 0.\n\\]\n\n\n\n\n\n\n\nTip証明\n\n\n\n\n\n\nProof. \\(x^*\\) が内点であるので、すべての不等式制約は厳密に満たされている：\n\\[\ng_j(x^*) &gt; 0 \\quad \\forall j \\in J.\n\\]\nFritz–John 定理の相補スラック条件より、\n\\[\n\\lambda_j g_j(x^*) = 0 \\quad \\forall j \\ge 1.\n\\]\nここで \\(g_j(x^*) &gt; 0\\) であるため、\n\\[\n\\lambda_j = 0 \\quad \\forall j \\ge 1\n\\]\nが成り立つ。 これを Fritz–John の1階条件に代入すると、\n\\[\n\\lambda_0 \\nabla g_0(x^*) = 0\n\\]\nを得る。 さらに、\\((\\lambda_0, \\lambda_1, \\dots, \\lambda_J)\\) が零ベクトルではないことから \\(\\lambda_0 \\ne 0\\) が成立する。\nしたがって両辺を \\(\\lambda_0\\) で割ることで、\n\\[\n\\nabla g_0(x^*) = 0\n\\]\nを得る。\n\n\n\n\n上の補題 Lemma 1　は、内点解においてはラグランジュ乗数がすべてゼロとなり、\n問題が制約なし最適化問題に帰着することを示しています。\nすなわち、「制約がbindingしていない＝緩い（slack）」場合、\n最適化の一階条件は単純に\n\\[\n\\nabla g_0(x^*) = 0\n\\]\nで与えられることがわかりました。\n\n\n\nここでは補題 Lemma 1 の結論（内点では \\(\\nabla g_0(x^*)=0\\)）を用いて、内点解の解析解を求めます。\n内点では不等式制約の乗数はすべて \\(0\\)、したがって FJ の停留条件は \\[\n\\nabla g_0(x^*)=\\mathbf{0}\n\\quad\\Longleftrightarrow\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial c_m}=0,\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial c_f}=0,\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial l_m}=0,\\quad\n\\frac{\\partial\\mathcal{L}}{\\partial l_f}=0.\n\\]\nこれより \\[\n\\frac{1}{c_m}=\\lambda,\\quad\n\\frac{1}{c_f}=\\lambda\n\\ \\Rightarrow\\\nc_m=c_f=\\frac{1}{\\lambda},\n\\] \\[\n\\frac{1}{l_m}=\\lambda w_m\n\\ \\Rightarrow\\\nl_m=\\frac{1}{\\lambda w_m},\\qquad\n\\frac{1}{l_f}=\\lambda w_f\n\\ \\Rightarrow\\\nl_f=\\frac{1}{\\lambda w_f}.\n\\]\n等式制約に代入して \\(\\lambda\\) を決定：\n\\[\n\\frac{2}{\\lambda}\n=w_m\\!\\left(1-\\frac{1}{\\lambda w_m}\\right)\n+w_f\\!\\left(1-\\frac{1}{\\lambda w_f}\\right)\n=(w_m+w_f)-\\frac{2}{\\lambda}\n\\ \\Longrightarrow\\\n\\lambda=\\frac{4}{w_m+w_f}.\n\\]\nよって内点解の候補は\n\\[\n\\boxed{\n\\;\nc_m^*=c_f^*=\\frac{w_m+w_f}{4},\\quad\nl_m^*=\\frac{w_m+w_f}{4w_m},\\quad\nl_f^*=\\frac{w_m+w_f}{4w_f}\\;\n}\n\\]\n\n\n\n\n\n\nTip検算（等式制約）\n\n\n\n\n\n\\[\nc_m^*+c_f^*=\\frac{w_m+w_f}{2},\n\\] \\[\nw_m(1-l_m^*)+w_f(1-l_f^*)\n=w_m\\!\\left(1-\\frac{w_m+w_f}{4w_m}\\right)\n+w_f\\!\\left(1-\\frac{w_m+w_f}{4w_f}\\right)\n=\\frac{w_m+w_f}{2}.\n\\] 両辺が一致。\n\n\n\n\n\n\n\n\n\nTip補足：必要条件（FJ条件）の使い方\n\n\n\n\n\n（出典：宮川(2022)\n（以下、内容は第3節「必要条件の使い方」に基づく要約）\n\n\n必要条件の使い道は消去法である。\n必要条件を満たさないものは解ではないので，すべて除外してよい。\n必要条件を満たす点だけに集中すればよい。\nFJ条件は「微分したものがゼロ」というシャープな条件なので、\n通常はほとんどの候補が消去され、残るのはごく少数である。\n典型的な効用最大化問題では、残る候補が1つだけになることが多い。\n残りが1つだけであれば、それ以外はすべて解でないので、\nもし解が存在するなら、その1つが解であると結論できる。\n\n\n\n残り1つの候補が真の解であるためには、まず解の存在を確認する必要がある。\n存在の証明には、非線形計画法よりも一般的なワイエルシュトラスの定理を使うのが定石である。\nワイエルシュトラスの定理\n&gt; \\(f : X \\to \\mathbb{R}\\) が連続関数で，\n&gt; \\(X \\subset \\mathbb{R}^n\\) が有界かつ閉（コンパクト）で非空なら，\n&gt; \\(X\\) 内に \\(f\\) を最大にする点が存在する。\n標準的な消費者問題では，予算集合が有界かつ閉であり，\n効用関数が連続（微分可能）なので，この定理を適用できる。\nしたがって，効用最大化問題の解の存在が保証される。\n\n\n\nワイエルシュトラス定理などにより解の存在が保証され，\nFJ条件によって \\(x\\) が1つに絞れたなら，その \\(x\\) は最適解である。\n他の点はすでに消去済みなので，それ以外に解は存在しない。\nこのとき、必要条件（十分条件ではない）を使いながらも、\n解の存在と組み合わせることで唯一解を特定できる。\n\n\n\nもしFJ条件で解候補が複数残った場合でも、\n残りの候補が少数ならば、それらの間で目的関数 \\(g_0(x)\\) の値を比較すればよい。\n残った中で \\(g_0(x)\\) が最大の点が最適解である。\nすでに存在が保証されているなら、その点が唯一の最適解と断定できる。\n要するに：\n\n必要条件は「最適解を直接求める」ためではなく、\n「最適でないものを排除する」ための道具である。\n凹最適化や消費者問題のように、候補が1つに絞れる状況では、\n必要条件＋存在定理だけで最適解を完全に特定できる。\n\n\n\n\n\n\n\n\nここでは，先ほど求めた内点候補が真の最適解であることを示します：\n\nTheorem 2 アロー＝エントーベン定理（Arrow and Enthoven, 19613\n最大化問題\n\\[\n\\max_x g_0(x) \\quad \\text{s.t. } g_j(x) \\ge 0, \\; j=1,\\ldots,J\n\\]\nにおいて、各 \\(g_j\\) が準凹関数で \\(x\\) において微分可能であるとする。\nもし \\(x\\) が Fritz–John 条件と \\(\\lambda_0&gt;0\\) を満たす \\(\\lambda\\) を伴い、かつ\n\\[\n\\nabla g_0(x) \\ne 0\n\\]\nが成立するならば、\\(x\\) は最大化問題の解である。\n\n\n\n最適化問題は\n\\[\n\\max_{c_m,c_f,l_m,l_f}\\; g_0(x)=\\log c_m+\\log l_m+\\log c_f+\\log l_f\n\\quad\\text{s.t.}\\quad\n\\begin{cases}\ng_1(x)=w_m(1-l_m)+w_f(1-l_f)-c_m-c_f\\ \\ge 0,\\\\\n0\\le l_m\\le 1,\\quad 0\\le l_f\\le 1,\\quad c_m\\ge 0,\\ c_f\\ge 0.\n\\end{cases}\n\\]\nでした。\n\n準凹性・微分可能性：\\(g_0\\) は厳密凹（⇒ 準凹）で，\\(g_1\\)・上下界制約はいずれもアフィン（⇒ 準凹），いずれも候補点で微分可能。\n\nFJ（KKT）成立：予算は 局所非飽和性の下で等号（\\(g_1(x^*)=0\\)）となり，他の不等式は厳密不等号（\\(0&lt;l_i^*&lt;1\\), \\(c_i^*&gt;0\\)）。よって相補スラックより \\(\\lambda_1\\ge 0\\), 他の乗数は \\(0\\)，さらに \\(\\lambda_0&gt;0\\)（KKT形）。\n\n勾配がゼロでない：\\(x^*\\) で \\[\n\\nabla g_0(x^*)=\\left(\\tfrac{1}{c_m^*},\\,\\tfrac{1}{l_m^*},\\,\\tfrac{1}{c_f^*},\\,\\tfrac{1}{l_f^*}\\right)\\neq 0.\n\\] が成立します。\n\n\n\n\n以上より、先ほど求めた内点候補は，アロー＝エントーベンの十分条件をすべて満たします。したがって、内点解候補\n\\[\n\\boxed{\n\\begin{align}\nc_m^*=c_f^* & =\\frac{w_m+w_f}{4},\\\\\nl_m^* & =\\frac{w_m+w_f}{4w_m},\\\\\nl_f^* & =\\frac{w_m+w_f}{4w_f}\n\\end{align}\n}\n\\]\nは最適解です。\n\n\n\n内点では \\(0&lt;l_m^*,l_f^*&lt;1\\) が必要です。上式より \\[\n\\begin{align}\n\\frac{w_m+w_f}{4w_m}&lt;1 & \\Longleftrightarrow & \\frac{w_f}{w_m}&lt;3, \\\\\n\\frac{w_m+w_f}{4w_f}&lt;1 & \\Longleftrightarrow & \\frac{w_m}{w_f}&lt;3.\n\\end{align}\n\\]\nしたがって \\[\n\\frac{1}{3}&lt;\\frac{w_m}{w_f}&lt;3\n\\] のとき、上の内点解が実現します。\nこの条件を満たさない場合、すなわち\n\\[\n\\begin{align}\n\\frac{w_m}{w_f}\\ge 3 & \\Longrightarrow & l_f^*\\ge 1 \\\\\n\\frac{w_m}{w_f}\\le \\frac{1}{3} & \\Longrightarrow & l_m^*\\ge 1\n\\end{align}\n\\]\nとなり内点解である条件を満たしません。このときの端点解を以下で別途で検証していきます。\n\n\n\n\n以下ではFJ条件を用いて、以下の3つの端点ケースが最適性の必要条件を満たすかを確認していきます。\\(c_{i}, i \\in \\{m, f\\}\\)については内点解を仮定します。\n\\[\n\\begin{aligned}\nl_m = 1,　& 0 &lt; l_f &lt; 1 & \\text{(ケース A)} \\\\\n0 &lt; l_m &lt; 1,　& l_f = 1 & \\text{(ケース B)} \\\\\nl_m = 1,　& l_f = 1 & \\text{(ケース C)}\n\\end{aligned}\n\\]\n以下では次の命題4を使います。\n\nProposition 1 すべての不等式制約がアフィンなら、FJ条件に \\(\\lambda_0&gt;0\\) を追加できる。\n\n\n\n\n\n\n\nTip証明\n\n\n\n\n\n\nProof. 証明は宮川(2022)の補足資料を参照。\n\n\n\n\n\n\n相補スラックより \\(1-l_m=0 \\Rightarrow \\lambda_2\\ge0\\)（他は slack）。FJ の1階条件は：\n\\[\n\\begin{align}\n\\frac{1}{c_m}=\\lambda_1, \\quad \\frac{1}{c_f}=\\lambda_1 & \\Rightarrow & c_m=c_f=\\frac{1}{\\lambda_1}. \\\\\n\\frac{1}{l_f}-\\lambda_1 w_f=0 & \\Rightarrow & l_f=\\frac{1}{\\lambda_1 w_f}, \\\\\n\\underbrace{\\frac{1}{l_m}}_{=1}-\\lambda_1 w_m-\\lambda_2=0 & \\Rightarrow & \\lambda_2=1-\\lambda_1 w_m \\ge 0.\n\\end{align}\n\\]\n予算制約式より、 \\[\n\\frac{2}{\\lambda_1}=w_f \\left(1-\\frac{1}{\\lambda_1 w_f}\\right) \\Longrightarrow \\lambda_1=\\frac{3}{w_f}.\n\\]\nしたがって \\[\n\\begin{align}\nc_m^*=c_f^* & =\\frac{w_f}{3},\\\\\nl_f^* & =\\frac{1}{3},\\\\\nl_m^* & =1.\n\\end{align}\n\\]\n成立条件は： \\[\n\\lambda_2=1-\\frac{3w_m}{w_f}\\ge 0 \\Longleftrightarrow \\frac{w_m}{w_f}\\le\\frac{1}{3}.\n\\]\n\n\n\nケースAと同様の計算で\n\\[\n\\begin{align}\n\\lambda_1 & =\\frac{3}{w_m},\\\\\nc_m^*=c_f^* & =\\frac{w_m}{3},\\\\\nl_m^* & =\\frac{1}{3},\\\\\nl_f^* & =1,\n\\end{align}\n\\] 成立条件は：\n\\[\n\\lambda_3 =1-\\frac{3w_f}{w_m}\\ge 0 \\Longleftrightarrow \\frac{w_m}{w_f}\\ge 3.\n\\]\n\n\n\n賃金所得が 0 で予算 \\(c_m+c_f=0\\)。非負制約より \\(c_m=c_f=0\\) だが \\(\\log 0=-\\infty\\)。\n微小な調整（どちらかが僅かに働く・消費を正にする）で効用が改善できるため、最適解になり得ないことがわかります。\n以上より、端点解でFJ条件を満たすものは\n\\[\n\\boxed{\n\\begin{align}\nc_m^*=c_f^* & =\\frac{w_f}{3},\\\\\nl_f^* & =\\frac{1}{3},\\\\\nl_m^* & =1.\n\\end{align}\n}\n\\]\nおよび\n\\[\n\\boxed{\n\\begin{align}\n\\lambda_1 & =\\frac{3}{w_m},\\\\\nc_m^*=c_f^* & =\\frac{w_m}{3},\\\\\nl_m^* & =\\frac{1}{3},\\\\\nl_f^* & =1,\n\\end{align}\n}\n\\]\nとなります。アロー＝エントーベンの定理　(Theorem 2)　よりこれらは最適解の十分条件を満たします。\n\n\n\n\n\n以上の結果より、\\(\\gamma_c = \\gamma_l = 1\\)、すなわち \\(u(c,l) = \\log c + \\log l\\) としたときの最適化問題に対する \\(c_m, c_f, l_m, l_f\\) の解析解は\n\n\n\\[\n\\begin{align}\nc_m^* = c_f^* &= \\frac{w_m + w_f}{4},\\\\\nl_m^* &= \\frac{w_m + w_f}{4w_m},\\\\\nl_f^* &= \\frac{w_m + w_f}{4w_f}.\n\\end{align}\n\\]\n\n\n\n\\[\n\\begin{align}\nc_m^* = c_f^* &= \\frac{w_f}{3},\\\\\nl_f^* &= \\frac{1}{3},\\\\\nl_m^* &= 1.\n\\end{align}\n\\]\n\n\n\n\n\n\\[\n\\begin{align}\n\\lambda_1 &= \\frac{3}{w_m},\\\\\nc_m^* = c_f^* &= \\frac{w_m}{3},\\\\\nl_m^* &= \\frac{1}{3},\\\\\nl_f^* &= 1.\n\\end{align}\n\\]\nの3パターンとなります。すなわち、夫婦の賃金比 \\(w_m/w_f\\) に応じて内点解、端点解A、端点解Bの3つに決まります。"
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html#問-1.2question-2",
    "href": "notes/Macroiv_assign1_TA.html#問-1.2question-2",
    "title": "Exercise 1: Numerical Methods",
    "section": "",
    "text": "\\(w_m, w_f\\) を所与とした，\\(\\gamma_c, \\gamma_l \\ne 1\\) のときに数値解を求める関数をプログラムせよ。\n\\(w_m = 1.0\\) とし，\\(w_f \\in [0.1, 1.0]\\) の範囲の値を取るときの\n\\(c_m, c_f, l_m, l_f\\) の値をプロットせよ。\nこの時，数値解の正しさを確認するために，\\(\\gamma_c = \\gamma_l = 0.95\\) の場合と\n\\(\\gamma_c = \\gamma_l = 1.05\\) の場合の数値解を上で求めた解析解（\\(\\gamma_c = \\gamma_l = 1\\)）の三つをプロットせよ。\n\n\n先程までは \\(\\gamma_c = \\gamma_l = 1\\)　の場合の解析解を求めましたが、今回はCRRA効用において \\(\\gamma_c, \\gamma_l \\ne 1\\) の時の最大解を数値計算によって求めます。\n\n\n簡単に書きます。\n効用関数を一般のCRRA型（\\(\\gamma_c, \\gamma_l \\ne 1\\)）として先程の問1.1と同じ手順を踏んでいきます。\n\\[\nu(c,l) = \\frac{c^{1 - \\gamma_c} - 1}{1 - \\gamma_c}\n+ \\frac{l^{1 - \\gamma_l} - 1}{1 - \\gamma_l}.\n\\]\n与えられた賃金 \\(w_m, w_f\\) の下で、次の最大化問題を考えます：\n\\[\n\\max_{c_m, c_f, l_m, l_f} \\; u(c_m, l_m) + u(c_f, l_f)\n\\quad \\text{s.t.} \\quad\nc_m + c_f = w_m (1 - l_m) + w_f (1 - l_f),\n\\]\nただし \\(0 \\le l_m, l_f \\le 1,\\ c_m, c_f \\ge 0\\)。\n\n\n\n\n効用関数 \\(u(c,l)\\) は \\((0,\\infty)\\times(0,1]\\) 上で連続であり、\n制約集合も有界かつ閉であるため（\\(0 \\le l_i \\le 1\\), \\(c_i \\ge 0\\)）、\nよってワイエルシュトラスの定理により最大解の存在が保証されます。\nさらに、\\(u(c,l)\\) は各変数に関して厳密に凹関数であるため、\n制約集合が凸であることから最大解は一意といえます。\n\n\n\n\\(c_i = 0\\) または \\(l_i = 0\\) の場合、\\(u(c,l)\\) の導関数が発散するため、\nこれらの点は最適解ではありえません。\n\n\\(l_i = 0\\) の場合：\\(u_l(c,0) = \\lim_{l \\to 0+} l^{-\\gamma_l} = +\\infty\\)。\n労働を少し減らして余暇を増やすと効用が上がるため、\\(l_i=0\\) は排除されます。\n\\(c_i = 0\\) の場合：\\(u_c(0,l) = \\lim_{c \\to 0+} c^{-\\gamma_c} = +\\infty\\)。\n消費を少し増やすと効用が無限に上昇するため、\\(c_i=0\\) も排除されます。\n\nしたがって、最大解は次の内点領域に存在することになります： \\[\nc_m&gt;0,\\quad c_f&gt;0,\\quad 0&lt;l_m&lt;1,\\quad 0&lt;l_f&lt;1.\n\\]\n\n\n\n上の内点領域では、効用関数および制約式はいずれも滑らかであるため、\nFJ条件をそのまま適用できます。\nラグランジュ関数を定義： \\[\n\\mathcal{L}(c_m, c_f, l_m, l_f, \\lambda)\n= u(c_m, l_m) + u(c_f, l_f)\n+ \\lambda \\big[w_m(1-l_m)+w_f(1-l_f)-c_m-c_f\\big].\n\\]\n1階条件： \\[\n\\begin{aligned}\n\\frac{\\partial \\mathcal{L}}{\\partial c_m} &= c_m^{-\\gamma_c} - \\lambda = 0,\\\\\n\\frac{\\partial \\mathcal{L}}{\\partial c_f} &= c_f^{-\\gamma_c} - \\lambda = 0,\\\\\n\\frac{\\partial \\mathcal{L}}{\\partial l_m} &= l_m^{-\\gamma_l} - \\lambda w_m = 0,\\\\\n\\frac{\\partial \\mathcal{L}}{\\partial l_f} &= l_f^{-\\gamma_l} - \\lambda w_f = 0.\n\\end{aligned}\n\\]\nここから、 \\[\nc_m = c_f = \\lambda^{-1/\\gamma_c}, \\qquad\nl_m = (\\lambda w_m)^{-1/\\gamma_l}, \\quad\nl_f = (\\lambda w_f)^{-1/\\gamma_l}.\n\\]\nしたがって、 \\[\n\\begin{align}\n\\lambda & = \\frac{l_f^{-\\gamma_l}}{w_f} \\\\\nc_m=c_f & =\\lambda^{-1/\\gamma_c}=w_f^{1/\\gamma_c}\\, l_f^{\\gamma_l/\\gamma_c},\n\\end{align}\n\\]\n\\[\n\\begin{align}\nl_m & =(\\lambda w_m)^{-1/\\gamma_l} \\\\\n& = \\Big(\\tfrac{w_m}{w_f}\\,l_f^{-\\gamma_l}\\Big)^{-1/\\gamma_l} \\\\\n& =\\Big(\\tfrac{w_f}{w_m}\\Big)^{1/\\gamma_l}\\, l_f.\n\\end{align}\n\\]\nこれを予算制約式 \\(c_m+c_f=w_m(1-l_m)+w_f(1-l_f)\\) に代入すると，\n\\[\n\\boxed{\n2\\,w_f^{1/\\gamma_c}\\,l_f^{\\gamma_l/\\gamma_c}\n+\\Big[w_m\\Big(\\tfrac{w_f}{w_m}\\Big)^{1/\\gamma_l}+w_f\\Big]\\,l_f\n-\\,(w_m+w_f)=0\n}\n\\]\nこの方程式を数値的に解き、\\(l_f\\) の最大解をもとめることでその他の \\((c_m, c_f, l_m)\\) が求まります。\n\n\n内点解は\n\\[\n0 &lt; l_m &lt; 1, \\quad 0 &lt; l_f &lt; 1\n\\]\nが成立する解のことでした。下限側（\\(l_i&gt;0\\), \\(c_i&gt;0\\)）については、そうでない場合は上で述べたように最適解とはなりえないことが分かっているので、上限側の条件（\\(l_i&lt;1\\)）のみを確認すればよいことになります。 一階条件より \\[\nl_i = (\\lambda w_i)^{-1/\\gamma_l}, \\quad i \\in \\{m, f\\}.\n\\]\nしたがって、 \\[\nl_i &lt; 1\n\\iff\n\\lambda w_i &gt; 1.\n\\]\nここで \\(w_m &gt; w_f\\) の場合、\\(\\lambda w_f &gt; 1\\) を満たせば自動的に \\(\\lambda w_m &gt; 1\\) も満たされます。\nよって、内点解の可否は次のようにまとめられます：\n\\[\n\\boxed{\n\\lambda w_f &gt; 1\n\\longrightarrow 0 &lt; l_f &lt; (w_m/w_f)^{1/\\gamma_l}\n}\n\\]\n\n\n\n\n\n最適化の条件式は:\n\\[\n\\begin{align}\nl_f & =1, \\\\\nl_m & =(\\lambda w_m)^{-1/\\gamma_l}, \\\\\nc_m=c_f & =\\lambda^{-1/\\gamma_c}.\n\\end{align}\n\\]\n\\(\\lambda=\\dfrac{l_m^{-\\gamma_l}}{w_m}\\) を用い、予算制約\n\\[\nc_m+c_f=w_m(1-l_m)\n\\] に代入すると、 \\[\n2 w_m^{1/\\gamma_c} l_m^{\\gamma_l/\\gamma_c}+w_m l_m- w_m =0.\n\\]\n可否条件 \\[\n\\lambda w_f \\le 1 \\Longleftrightarrow\\ \\Big(\\tfrac{w_f}{w_m}\\Big) l_m^{-\\gamma_l}\\le 1\n\\Longleftrightarrow l_m \\ge \\Big(\\tfrac{w_f}{w_m}\\Big)^{1/\\gamma_l},\n\\]\n\n\n\n\n\nこの場合は \\(l_f=1\\) なので、端点Aと対称に \\(l_m\\) について\n\\[\n\\begin{align}\nl_m & =1, \\\\\nl_f & =(\\lambda w_f)^{-1/\\gamma_l}, \\\\\nc_m=c_f & =\\lambda^{-1/\\gamma_c}.\n\\end{align}\n\\]\n\\(\\lambda=\\dfrac{l_f^{-\\gamma_l}}{w_f}\\) を用い、予算制約 ( c_m+c_f=w_f(1-l_f) ) に代入すると， \\[\n2 w_f^{1/\\gamma_c} l_f^{\\gamma_l/\\gamma_c} + w_f l_f-w_f=0.\n\\]\n可否条件 \\[\n\\lambda w_m \\le 1 \\Longleftrightarrow \\Big(\\tfrac{w_m}{w_f}\\Big) l_f^{-\\gamma_l}\\le 1\n\\Longleftrightarrow l_f \\ge \\Big(\\tfrac{w_m}{w_f}\\Big)^{1/\\gamma_l},\n\\]\n\n\n\\[\nc_m + c_f = 0\n\\]\n予算式から上式が成立します。\nところが、非負制約より \\(c_m, c_f \\ge 0\\) なので\n\\[\nc_m = c_f = 0.\n\\]\nCRRA 型効用の限界効用は \\(c_i \\to 0\\) のとき発散し、\nすなわち\n\\[\n\\lim_{c_i \\to 0} u(c_i, l_i)\n= \\frac{c_i^{1-\\gamma_c} - 1}{1-\\gamma_c}\n\\to -\\infty.\n\\]\nしたがって，この場合の効用は\n\\[\nu(c_m, l_m) + u(c_f, l_f) \\to -\\infty,\n\\]\nとなり，わずかでも消費や余暇を増やすことで効用が改善できます。\nゆえに Corner C（\\(l_m=1,\\ l_f=1\\)）は最適解になり得ない（除外）ことがわかります。\n\n\n\n\n\n\n以下の結果を出すために数値コードが実行している処理を、アルゴリズムとして整理して説明します。\n\n\nアルゴリズムはまず、夫婦の労働供給が「内点解」になるか「端点解」になるかを判定します。\n\n女性の労働を未知変数として扱い、男性の労働は一階条件から\n\\[\nl_m = \\left(\\frac{w_f}{w_m}\\right)^{1/\\gamma_l} l_f\n\\]\nで決定します。\nこの関係と予算制約に基づいて導出した方程式\n\\[\nf(l_f)=2 w_f^{1/\\gamma_c} l_f^{\\gamma_l/\\gamma_c}+w_f l_f- w_f =0.\n\\] を使います。\n区間 (\\(0,1\\)) の端点付近で\n\\[\nf(0+\\varepsilon)\\cdot f(1-\\varepsilon) &lt; 0\n\\] が成り立つ場合、内点に根が存在し、内点解が成立します。\n成り立たない場合は端点解となり、女性が完全に労働する\n\\[\nl_f = 1\n\\] という条件のもとで、男性の労働を別の方程式\n\\[\nf_B(l_m)=2 w_m^{1/\\gamma_c} l_m^{\\gamma_l/\\gamma_c}+w_m l_m- w_m =0\n\\] により求めます。\n\n\n\n\n内点解が成立した場合、以下の処理を行います。\n\n女性の労働供給 \\(l_f\\) を区間 \\((0,1)\\) 内で数値的に求めます。\n男性の労働供給は \\[\nl_m = \\left(\\frac{w_f}{w_m}\\right)^{1/\\gamma_l} l_f\n\\] により計算します。\n\n\n\n\n内点に解が存在しない場合は、端点解として\n\n女性は完全に労働：\\(l_f = 1\\)\n男性については方程式 \\(f_B(l_m)=0\\) を数値的に解く\n\nという手順で求めます。\n\n\n\n総所得\n\\[\nc_m+c_f= w_m(1-l_m) + w_f(1-l_f)\n\\] より \\[\nc_m = c_f = \\frac{[w_m(1-l_m) + w_f(1-l_f)]}{2}\n\\] を得ます。\n\n\n\n\n\n\nsolve_bargaining (generic function with 1 method)\n\n\n\n\n\nSolutions of bargaining problem. \\(w_m = 1.0, w_f \\in [0.1, 1.0], \\gamma_c = \\gamma_l = 1.5\\).\n\n\n\n\nanalytical_solution (generic function with 1 method)\n\n\n\n\n\nSolutions of bargaining problem. _c = _l = 0.95 1.00 1.05$."
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html#問-1.3ガウスエルミート求積",
    "href": "notes/Macroiv_assign1_TA.html#問-1.3ガウスエルミート求積",
    "title": "Exercise 1: Numerical Methods",
    "section": "",
    "text": "ガウス・エルミート求積を用いて、\\(l_m, l_f\\) の期待値を求めよ。その際、 \\(\\mu_m = 0, \\mu_f = -0.2, \\sigma_m = \\sigma_f = 1.0, \\rho = 0.7\\) とする。 効用関数は \\(\\gamma_c = \\gamma_l = 1\\) とする（そのため、問1.1の結果を用いれば良い）。 また、結果を \\(N = 10^6\\) 程度のモンテカルロ法と比較せよ。\n\n\n平均 \\(\\mu\\)、分散共分散行列 \\(\\Sigma\\) の多変量正規分布のガウス・ヘルミート求積は以下のように導出できる。 \\(z = \\frac{1}{\\sqrt{2}}L^{-1}(x - \\mu)\\) として、\n\\[\n\\begin{align}\nS &= \\int v(\\exp(x)) \\, dF(x) \\\\\n  &= \\int v(\\exp(x))\n     \\frac{1}{\\sqrt{\\det(2\\pi\\Sigma)}}\n     \\exp\\!\\left(\n       -\\frac{1}{2}(x - \\mu)^\\top \\Sigma^{-1}(x - \\mu)\n     \\right) dz \\\\[1em]\n  &= \\int\n     v\\!\\left(\\exp(\\mu + \\sqrt{2}Lz)\\right)\n     \\pi^{-\\frac{N}{2}}\n     \\exp(-z^\\top z)\n     v\\!\\left(\\mu + \\sqrt{2}Lz\\right)\n     dz \\\\[1em]\n  &= \\int\n     v\\!\\left(\\exp(\\mu + \\sqrt{2}Lz)\\right)\n     \\pi^{-\\frac{N}{2}}\n     \\exp\\!\\left(\n       -\\sum_{n=1}^{N} z_n^2\n     \\right) dz \\\\[1em]\n  &\\approx\n     \\sum_i \\sum_j\n     \\theta_i \\theta_j \\pi^{-1}\n     v\\!\\left(\n       \\exp\\!\\left(\n         \\mu + \\sqrt{2}L(z_i, z_j)^\\top\n       \\right)\n     \\right)\n\\end{align}\n\\]\nここで、\\(L\\) は \\(\\Sigma\\) のコレスキー分解であり、 \\(LL^\\top = \\Sigma\\) を満たす行列である。\n\n\n\n\n\n計算の考え方（流れの概要）\n\n分布の設定\n夫婦の対数賃金 \\((\\log w_m, \\log w_f)\\) が平均 \\(\\mu=(\\mu_m,\\mu_f)\\)、共分散行列 \\(\\Sigma\\) に従うと仮定。\n賃金の従う分布関数の近似\n賃金の従う分布関数を、ガウス・エルミート求積 (Gauss–Hermite Quadrature) によって近似。\n節点と重みの生成\nFastGaussQuadrature.gausshermite() により節点 \\((z_i)\\) と重み \\((θ_i)\\) を得る。\n相関を導入した変換\n標準正規分布から共分散 \\(\\Sigma\\) をもつ分布へ変換する： \\[\nx = \\mu + \\sqrt{2}\\,Lz, \\quad L = \\text{chol}(\\Sigma)\n\\] そして \\(w = \\exp(x)\\) により賃金水準へ写像する。\n各節点で最適化を実行\n各 \\((w_m, w_f)\\) に対して、solve_bargaining() 関数を使い、夫婦の効用最大化問題を解いて \\[(c_m, c_f, l_m, l_f)\\] を得る。\n重み付き平均の計算\n各節点の結果を重み \\((θ_iθ_j)/π\\) で加重平均して期待値を求める： \\[\nE[l_m] \\approx \\sum_i\\sum_j \\frac{θ_i θ_j}{π} l_m(w_m, w_f)\n\\] \\(l_f\\)についても同様。\nモンテカルロ法との比較\n最後に、乱数サンプリング（\\(N=10^6\\)）による平均値と比較して、精度を確認する。\n\n\n\n問題文より、夫婦の対数賃金 \\(\\log(w_m), \\log(w_f)\\) は次の2次元正規分布に従うと仮定されています：\n\\[\n\\begin{pmatrix} \\log w_m \\\\ \\log w_f \\end{pmatrix}\n\\sim \\mathcal{N}\\left(\n\\begin{pmatrix} \\mu_m \\\\ \\mu_f \\end{pmatrix},\n\\begin{pmatrix}\n\\sigma_m^2 & \\rho\\sigma_m\\sigma_f \\\\\n\\rho\\sigma_m\\sigma_f & \\sigma_f^2\n\\end{pmatrix}\n\\right)\n\\]\n求めたいのは、最適労働時間 \\((l_m, l_f)\\) の期待値：\n\\[\n\\begin{align}\n\\mathbb{E}[l_m] & = \\iint l_m(w_m, w_f) f(w_m, w_f)\\,dw_m\\,dw_f\n\\mathbb{E}[l_f] & = \\iint l_f(w_m, w_f) f(w_m, w_f)\\,dw_m\\,dw_f\n\\end{align}\n\\]\nです。\n\n\n\nこの積分を直接解くのは困難なので、ガウス・エルミート求積を用いて次のように近似していきます：\n\\[\n\\mathbb{E}[l_m] \\approx\n\\sum_{i=1}^N \\sum_{j=1}^N\n\\theta_i \\theta_j \\frac{1}{\\pi}\\,\nl_m\\big(\\exp(\\mu + \\sqrt{2}Lz_{ij})\\big)\n\\]\nここで：\n\n\\((z_i, \\theta_i)\\)：1次元 Gauss–Hermite の節点と重み\n\n\\(L\\)：\\(\\Sigma\\) のコレスキー分解（\\(\\Sigma = LL^\\top\\)）\n\n\\(x = \\mu + \\sqrt{2}Lz\\) により標準正規から共分散 \\(\\Sigma\\) へ変換\n\n\\(\\exp(x)\\) により対数賃金から実際の賃金へ変換\n\nガウス・エルミート求積で何をやるかといえば、\\(w_m, w_f\\)　の従う２次元正規分布をいくつかの点で近似することです。Julia では、そのために標準ライブラリ FastGaussQuadrature.jl というパッケージの gausshermite(n) 関数を使うことができます。\n\n\n\n\n\n\nTip\\(w_m, w_f\\)　の従う２次元正規分布\n\n\n\n\n\n\\[\n\\log\n\\begin{pmatrix}\nw_m \\\\ w_f\n\\end{pmatrix}\n\\sim\n\\mathcal{N}\\!\\left(\n\\begin{pmatrix}\n\\mu_m \\\\ \\mu_f\n\\end{pmatrix},\n\\begin{pmatrix}\n\\sigma_m^2 & \\rho \\sigma_m \\sigma_f \\\\\n\\rho \\sigma_m \\sigma_f & \\sigma_f^2\n\\end{pmatrix}\n\\right)\n\\]\nここで： - \\(\\mu_m, \\mu_f\\)：平均\n- \\(\\sigma_m, \\sigma_f\\)：標準偏差\n- \\(\\rho\\)：相関係数（\\(-1 &lt; \\rho &lt; 1\\)）\n上の仮定のもとで、\\((x_m, x_f) = (\\log w_m, \\log w_f)\\) の確率密度関数は次のように表されます：\n\\[\nf(\\log w_m, \\log w_f)\n= \\frac{1}{2\\pi\\sigma_m\\sigma_f\\sqrt{1-\\rho^2}}\n\\exp\\!\\left(\n-\\frac{1}{2(1-\\rho^2)}\n\\Big[\n\\frac{(\\log w_m-\\mu_m)^2}{\\sigma_m^2}\n- 2\\rho\\frac{(\\log w_m-\\mu_m)(\\log w_f-\\mu_f)}{\\sigma_m\\sigma_f}\n+ \\frac{(\\log w_f-\\mu_f)^2}{\\sigma_f^2}\n\\Big]\n\\right)\n\\]\n上の分布は「対数賃金」の分布です。\n実際の賃金 \\((w_m, w_f)\\) の分布に変換するには、ヤコビアン（Jacobian）による補正を行います。\nヤコビアン \\(J = |\\partial(\\log w_m, \\log w_f)/\\partial(w_m, w_f)| = 1/(w_m w_f)\\) を考慮すると、次のようになります：\n\\[\nf(w_m, w_f)\n= \\frac{1}{w_m w_f 2\\pi\\sigma_m\\sigma_f\\sqrt{1-\\rho^2}}\n\\exp\\!\\left(\n-\\frac{1}{2(1-\\rho^2)}\n\\Big[\n\\frac{(\\log w_m-\\mu_m)^2}{\\sigma_m^2}\n- 2\\rho\\frac{(\\log w_m-\\mu_m)(\\log w_f-\\mu_f)}{\\sigma_m\\sigma_f}\n+ \\frac{(\\log w_f-\\mu_f)^2}{\\sigma_f^2}\n\\Big]\n\\right)\n\\]\nこの式が、 &gt; 「\\(\\log w_m, \\log w_f\\) が平均 \\(\\mu\\), 分散共分散 \\(\\Sigma\\) に従うときの、\\((w_m, w_f)\\) の確率密度関数」 です。\nJulia では、Distributions.jl パッケージを用いることで、\nこの2次元正規分布を直接扱うことができます。\n\n\n0.16126050122638444\n\n\n\n\n\n問1.3では、夫婦それぞれの賃金があるので、forループを使ってgausshermite(n) を2次元版に拡張します。\n\n\n\n\n\ngh2d (generic function with 1 method)\n\n\n\n\nsolve_ana (generic function with 1 method)\n\n\n\n\nmean_leisure (generic function with 1 method)\n\n\n\n\n====ガウス・エルミート求積====\n男性の平均余暇 (l_m の期待値) = 0.5135366523292847\n女性の平均余暇 (l_f の期待値) = 0.6116338368206332\n\n\n\n\n\n最後に、乱数サンプリング(\\(N=10^6\\))による平均値と比較して、精度を確認します。\n\n\n====モンテカルロ計算の結果====\n男性の平均余暇 (l_m の期待値) = 0.513376753762486\n女性の平均余暇 (l_f の期待値) = 0.6113967672780644\n\n\n\n\n\n\n\n\nTipガウス・エルミート求積による近似を可視化する\n\n\n\n\n\n\n\n\n\n\nこの図からわかるようにガウス・エルミート求積は重みをうまく設定することで正規分布の分布関数に含まれる積分などの数値的に難しい積分を精度良く近似することができます。"
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html#policy-function-iteration",
    "href": "notes/Macroiv_assign1_TA.html#policy-function-iteration",
    "title": "Exercise 1: Numerical Methods",
    "section": "",
    "text": "授業では確率的動学モデルを Value Function Iteration によって解く方法を学んだ。\nここでは Policy Function Iteration (PFI) を用いて同様の問題を解く。\n\n\n\\[\nV(k, z) = \\max_{k'} \\left\\{ u(f(k, z) + (1 - \\delta)k - k') + \\beta \\mathbb{E}[V(k', z') \\mid z] \\right\\}.\n\\]\n生産性 \\(z\\) は以下のような AR(1) 過程に従う：\n\\[\n\\log z' = (1 - \\rho)\\mu + \\rho \\log z + \\sigma \\varepsilon, \\quad \\varepsilon \\sim \\mathcal{N}(0, 1).\n\\]\n関数形とパラメータは以下の通り：\n\n効用関数：\\(u(c) = \\log c\\)\n\n生産関数：\\(f(k, z) = z k^{\\alpha}\\)\n\nパラメータ：\\(\\beta = 0.96\\), \\(\\delta = 0.1\\), \\(\\alpha = 0.36\\)\n\n\\(z\\) は5つのグリッドに離散化し、PFIを用いて次を求める：\n\n政策関数：\\(k' \\coloneqq g(k, z)\\)\n\n価値関数：\\(V(k, z)\\)\n\nこれらをそれぞれの \\(z\\) に対してプロットせよ。\n\n\n離散化されたAR(1)過程を \\(\\Lambda(z, z')\\) と表すと、オイラー方程式は以下のように書ける：\n\\[\nu'(c) = \\beta \\sum_{z'} \\Lambda(z, z') \\, u'(c') \\, [f'(k', z') + (1 - \\delta)].\n\\]\n\n\n\nPFI終了後に \\(V(k, z)\\) を線型方程式で求めるには、次のようにする：\n\n\\(V(k, z)\\) は離散化されたグリッド上の行列\n\\(\\{V_{i_k, i_z}\\}_{i_k=1,\\dots,n_k,\\, i_z=1,\\dots,n_z}\\)\nである。\n\\(\\{V_{i_k, i_z}\\}\\) をベクトル化した \\(V\\) を考える： \\[\nV_{i_k + n_k (i_z - 1)} \\coloneqq V_{i_k, i_z}.\n\\]\nある \\((i_k, i_z)\\) に対して、\\(k_j &lt; g_{i_k, i_z} &lt; k_{j+1}\\) を満たす \\(j \\in \\{1, \\dots, n_k\\}\\) を求める。\n\\((k, z)\\) から \\((k', z')\\) への遷移は、\\(V\\) 上で\n\\(i_k + n_k (i_z - 1)\\) から \\(i_k' + n_k (i_z' - 1)\\) への遷移となる。\n遷移行列 \\(P\\) は以下のように定義され、定義されていない要素は \\(0\\) とする：\n\n\\[\nP_{i_k + n_k(i_z - 1), \\, j + n_k(i_z' - 1)} =\n\\begin{cases}\n\\Lambda_{i_z, i_z'} \\dfrac{k_{j+1} - g_{i_k, i_z}}{k_{j+1} - k_j}, & \\text{if } 1 &lt; j &lt; n_k, \\\\[6pt]\n\\Lambda_{i_z, i_z'}, & \\text{otherwise.}\n\\end{cases}\n\\]\n\\[\nP_{i_k + n_k(i_z - 1), \\, j+1 + n_k(i_z' - 1)} =\n\\begin{cases}\n\\Lambda_{i_z, i_z'} \\dfrac{g_{i_k, i_z} - k_j}{k_{j+1} - k_j}, & \\text{if } 1 &lt; j &lt; n_k, \\\\[6pt]\n\\Lambda_{i_z, i_z'}, & \\text{otherwise.}\n\\end{cases}\n\\]\n\n\n\n\n\n\nこの関数は、対数生産性 \\(y=\\log z\\) が従う AR(1) 過程\n\\[\ny' = (1-\\rho)\\mu + \\rho y + \\sigma \\varepsilon,\\quad \\varepsilon\\sim\\mathcal N(0,1)\n\\]\nを Tauchen (1986) 5 の手法で有限状態マルコフ連鎖に離散化します。\n\n\ntauchen_logz\n\n\n\n\n([0.14638167652140652, 0.3825985840556738, 1.0, 2.6137054387385943, 6.831456120491708], [0.9726680320541624 0.027331967937081036 … 0.0 0.0; 0.004119509412862319 0.980560996618286 … 1.6353585152728556e-12 0.0; … ; 2.80547015409681e-32 1.6353292102262342e-12 … 0.980560996618286 0.004119509412862321; 2.870957534331882e-60 4.699184351669941e-31 … 0.027331967937081043 0.9726680320541624], [0.03605705163302499, 0.23922998597687464, 0.44942592478020055, 0.23922998597687548, 0.03605705163302434])\n\n\n\n\n\n基本パラメータ：\n-   $\\alpha$：資本の所得分配率\n-   $\\beta$：割引因子\n-   $\\delta$：減耗率\n\n資本グリッド k_grid：\n資本の範囲 \\([k_{\\min}, k_{\\max}] = [0.05, 0.5]\\) を \\(n_k=101\\) 点で離散化。\n政策関数や補間の基盤。\n生産性プロセス：\nTauchen法により、AR(1)過程を離散化し、\\(n_z=5\\) の生産性状態 Z と遷移確率行列 Λ を生成。\n政策関数 h：\n行列サイズ \\((n_k, n_z)\\)。各列が特定の生産性状態 \\(z_j\\) に対応し、\\(h(k_i, z_j)\\) は資本 \\(k_i\\)・生産性 \\(z_j\\) における最適消費。\n価値関数 V:\n後で使うために確保\n\n\n\neuler_eq (generic function with 1 method)\n\n\n\n\npfi! (generic function with 1 method)\n\n\nオイラー方程式：\n\\[\nu'(c) = \\eta \\sum_{z'} \\Lambda(z,z') \\, u'(c') \\, [f'(k',z') + 1 - \\delta].\n\\]\n与えられた \\((k,z,c)\\) に対して、この式を満たす \\(c\\) を求めます。 コードの流れは以下の通り：\n\n次期資本の決定：\n\\[\nk' = f(k,z) + (1-\\delta)k - c\n\\]\n次期消費の補間：\n各 \\(z'\\) ごとに現在の政策関数 \\(h(k',z')\\) を線形補間で求める：\n期待値の計算：\nTauchen法で得た遷移確率行列 Λ[iz, izp] を使って期待値をとる： \\[\nE_z′[\\cdot] = \\sum_{z′} Λ(z,z′)[u′(c′)(f′(k′,z′)+1−δ)]\n\\]\n最適な消費を求める：\n\n\n\nbuild_model (generic function with 1 method)\n\n\n各 \\((k,z)\\) におけるオイラー方程式を満たす消費 \\(c\\) を求め、政策関数 \\(h(k,z)\\) を更新。\n手順は以下の通り：\n\n\\(z\\) のループ追加：\n確定的モデルに \\(z\\) のループを追加し、各生産性状態に対して政策更新を行う。\n可行な消費範囲の設定：\n符号チェックによる端点処理： 両端の符号が同じ場合は境界解を採用。そうでなければ find_zero() で根を求める。\n収束判定：\n\\[\n\\max |h_{new} - h| &lt; 10^{-6}\n\\] で終了。収束すれば「Converged」と出力。\n\n\n\nConverged in 29 iterations. sup‖Δh‖=8.583471663714537e-7\n\n\n\n\n\n結果の経済学的意味\nPFI により得られる政策関数は、以下の経済的特徴を再現：\n\n高い生産性 \\(z\\) のとき：\n所得が多く、消費水準も上昇。政策関数 \\(c = h(k,z)\\) は上方シフト。\n低い生産性 \\(z\\) のとき：\n所得が少なく、将来に備えて消費を抑制し、貯蓄を増やす。 政策関数 \\(c = h(k,z)\\) は下方シフト。\n\n\n\n\n\n\ncompute_vf! (generic function with 1 method)\n\n\n\n\nこの関数は、既に収束した消費政策 \\(h(k,z)\\) を所与として、価値関数 \\(V(k,z)\\) を\n一次方程式\n\\[\n(I - \\beta P) \\mathrm{vec}(V) = \\mathrm{vec}(u(h))\n\\]\nから解きます。ここで \\(P\\) は 1期先の状態遷移（\\((k,z) \\to (k',z')\\)）を表す行列です。\n\n\n\n\n\n\n入力：モデル m::Model\n\nグリッドとパラメータ：k_grid, Z（生産性の5グリッド）, Λ（Tauchenで得た遷移確率）, α, β, δ\n既に PFI で収束した政策：h[i_k, i_z] = h(k_i, z_i)（消費政策）\n\n出力：m.V を \\((n_k \\times n_z)\\) 行列として上書き（更新）\n\n\n\n\n\n\\(n_k = \\text{length}(k_{\\text{grid}})\\), \\(n_z = \\text{length}(Z)\\), 総状態数 \\(n = n_k n_z\\)。\n状態インデックスのフラット化：\n\n\\[\n\\text{idx}(i_k,i_z) = i_k + n_k (i_z - 1)\n\\]\nよって \\((k_i, z_j)\\) に対応する 一次元インデックスが 1..n に写像されます。こうしておくとインデックスの管理が楽です。\n\n\n\n各状態 \\((k_i, z_j)\\) で\n\\[\nr[\\text{idx}(i_k, i_z)] = u\\!\\left(h[i_k, i_z]\\right)\n\\]\nを代入。ここで \\(u(c) = \\log c\\)です。\n\n\n\n\n資本のLaw of Motion（消費 \\(c = h(k,z)\\) を使います）：\n\n\\[\ng \\equiv k' = z k^{\\alpha} + (1 - \\delta) k - c\n\\]\nこれは k_grid の定義域に クランプ（端に外れたら端点に吸着）。\n\n資本方向の線形補間（2点分配）\n\nsearchsortedlast(k_grid, g) により \\(g\\) が属する区間 \\([k_j, k_{j+1}]\\) を見つけ、\n\\[\nw_{\\mathrm{hi}} = \\frac{g - k_j}{k_{j+1} - k_j}, \\quad\nw_{\\mathrm{lo}} = 1 - w_{\\mathrm{hi}}\n\\]\nとします。これにより、次期資本が \\(k_j\\) と \\(k_{j+1}\\) にそれぞれ \\(w_{\\mathrm{lo}}, w_{\\mathrm{hi}}\\) で分配されます （区間外なら左端/右端に吸着）。\n\n生産性方向の遷移（Tauchen の \\(\\Lambda\\)）\n\n現在 \\(z = z_{i_z}\\) から次期 \\(z' = z_{i_z'}\\) へは確率 \\(\\Lambda[i_z, i_z']\\)。\nよって、1期先の joint 確率は\n\\[\n\\Pr\\bigl((k',z') = (k_j, z_{i_z'}) \\mid (k,z)\\bigr)\n= \\Lambda[i_z, i_z'] \\times w_{\\mathrm{lo}},\n\\]\n\\[\n\\Pr\\bigl((k',z') = (k_{j+1}, z_{i_z'}) \\mid (k,z)\\bigr)\n= \\Lambda[i_z, i_z'] \\times w_{\\mathrm{hi}}.\n\\]\nこれをフラット化インデックスに落として P[row, col] に加算します。\n\n直感的には、資本の線形補間と 生産性のマルコフ遷移（\\(\\Lambda\\)）を 同時に畳み込んだ行列 \\(P\\) を作っている感じです。\n\n\n\n\n連立一次方程式\n\\[\n(I - \\beta P)\\,V^{\\mathrm{vec}} = r\n\\]\nを直接解きます。得られた Vvec を\n\\[\nV = \\text{reshape}(Vvec, (n_k, n_z))\n\\]\nとして m.V に格納します。\n\n\n\n\n\\(g\\) がグリッド外に出た場合は 端点に吸着（j &lt;= 1 / j &gt;= n_k 分岐）。\n\n\n\n\nValue Function"
  },
  {
    "objectID": "notes/Macroiv_assign1_TA.html#footnotes",
    "href": "notes/Macroiv_assign1_TA.html#footnotes",
    "title": "Exercise 1: Numerical Methods",
    "section": "Footnotes",
    "text": "Footnotes\n\n\n忘れてしまった人はコアミクロの講義ノートを見返すか、宮川先生の宮川栄一「制約付き最大化の解法と厳密性」『国民経済雑誌』第225巻第3号, 2022年, pp.31–51を参照してください。↩︎\n凹関数上の最適化問題では一意性が保証されます。↩︎\nArrow, Kenneth J., and Alain C. Enthoven. “Quasi-Concave Programming.” Econometrica 29, no. 4 (1961): 779–800.↩︎\n宮川(2022)の命題1 (定理6)です。↩︎\nTauchen, G. (1986). Finite state markov-chain approximations to univariate and vector autoregressions. Economics letters, 20(2), 177-181.↩︎"
  },
  {
    "objectID": "research.html",
    "href": "research.html",
    "title": "Research",
    "section": "",
    "text": "Financial Globalization and the Risk of Sovereign Default\n\n\n\nWorking Paper\n\n\n\nThe Global Integration of Financial Markets and Sovereign Debt Risk\n\n\n\nNov 10, 2025\n\n\n\n\n\n\n\n\n\n\nDSGE Models through the Lens of Geometry\n\n\n\nWorking Paper\n\n\n\nYou can think of determinacy, expectations, and shocks in DSGE models as geometric features like shapes and flows within Hamiltonian systems, especially when looking at…\n\n\n\nNov 10, 2025\n\n\n\n\n\n\n\n\n\n\nOn the Sources of Macroeconomic Fluctuations in Sub-Saharan African Countries\n\n\n\nWorking Paper\n\n\n\nBayesian estimation of macro fluctuations in Sub-Saharan Africa.\n\n\n\nNov 10, 2025\n\n\n\n\n\n\n\n\n\n\nSpatial Inequality Matters for Macro in Sub-Saharan Africa?\n\n\n\nWorking Paper\n\n\n\nsee project note\n\n\n\nNov 10, 2025\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "notes.html",
    "href": "notes.html",
    "title": "Notes",
    "section": "",
    "text": "Foundations of Dynamic Stochastic General Equilibrium Model\n\n\n\n\n\n\n\n\n\n\n\n\nNotes on General Equilibrium\n\n\n\n\n\n\n\n\n\n\n\n\nNotes on Representative Agents\n\n\n\n\n\n\n\n\n\n\n\n\nNotes on Transversality Condition\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "notes/DSGE.html",
    "href": "notes/DSGE.html",
    "title": "Foundations of Dynamic Stochastic General Equilibrium Model",
    "section": "",
    "text": "In a dynamic stochastic general equilibrium framework, the optimality conditions and market clearing conditions for households, firms, and policymakers can be summarized as a system of nonlinear expectational equations:\n\\[\n    \\mathbb{E} F(x_{t+1}, y_{t+1}, x_t, y_t, z_t; \\theta) = 0\n\\]\nwhere\n\n\\(x_t \\in \\mathbb{R}^{n_x}\\) denotes the state (predetermined) variables\n\\(y_t \\in \\mathbb{R}^{n_y}\\) represents the jump (control) variables\n\\(z_t \\in \\mathbb{R}^{n_z}\\) stands for the exogenous processes, which typically evolve according to\n\n\\[\n        z_{t+1} = \\Lambda(\\theta) z_t + \\Sigma(\\theta) \\varepsilon_{t+1},\n        \\quad \\varepsilon_t \\sim \\mathcal{N}(0, I).\n\\]\n\n\\(\\theta\\) is the parameter vector collecting structural parameters of the model.\n\nThe function \\(F(\\cdot) = 0\\) is a compact representation of a set of equilibrium conditions, including the Euler equations, labor supply conditions, price-setting equations, capital accumulation dynamics, policy rules, etc.\n\n\nAn illustrative framework embedding the Euler equation characterizing the intertemporal optimization behavior of a representative household.\nThe representative household maximizes expected lifetime utility:\n\\[\n    \\max_{c_{t}, k_{t+1}, n_{t}} \\mathbb{E}_{0} \\sum^{\\infty}_{t=0} \\beta^{t} U(c_{t}, 1-n_{t})\n\\]\nsubject to the intertemporal budget constraint:\n\\[\nc_{t}+k_{t+1} = (1-\\delta)k_{t}+w_{t}n_{t}+r_{t}k_{t}\n\\]\n\n\nFrom the optimallity conditions, we obtain:\n\n\\(\\lambda_{t} = U_{c}(c_{t}, 1-n_{t})\\)\n\\(\\lambda_{t} = -U_{n}(c_{t}, 1-n_{t})/w_{t}\\)\n${t} = {t}[{t+1}(r{t+1}+1-)] $\n\nFrom equations (1) and (3), we obtain the canonical Euler equation, which characterizes the intertemporal trade-off in consumption.\nBy substituting equations (1) through (3) into the system and rearranging, the model can be expressed in the form of a moment condition:\n\\[\n    \\mathbb{E}_{t}\\Biggl[ F(x_{t+1}, y_{t+1}, x_{t}, y_{t}, z_{t}; \\theta) \\Biggr] = 0\n\\]\nThis formulation embeds the Euler condition within a broader structural framework suitable for estimation or simulation."
  },
  {
    "objectID": "notes/DSGE.html#example-a-structure-incorporating-the-euler-equation-of-a-representative-household",
    "href": "notes/DSGE.html#example-a-structure-incorporating-the-euler-equation-of-a-representative-household",
    "title": "Foundations of Dynamic Stochastic General Equilibrium Model",
    "section": "",
    "text": "An illustrative framework embedding the Euler equation characterizing the intertemporal optimization behavior of a representative household.\nThe representative household maximizes expected lifetime utility:\n\\[\n    \\max_{c_{t}, k_{t+1}, n_{t}} \\mathbb{E}_{0} \\sum^{\\infty}_{t=0} \\beta^{t} U(c_{t}, 1-n_{t})\n\\]\nsubject to the intertemporal budget constraint:\n\\[\nc_{t}+k_{t+1} = (1-\\delta)k_{t}+w_{t}n_{t}+r_{t}k_{t}\n\\]\n\n\nFrom the optimallity conditions, we obtain:\n\n\\(\\lambda_{t} = U_{c}(c_{t}, 1-n_{t})\\)\n\\(\\lambda_{t} = -U_{n}(c_{t}, 1-n_{t})/w_{t}\\)\n${t} = {t}[{t+1}(r{t+1}+1-)] $\n\nFrom equations (1) and (3), we obtain the canonical Euler equation, which characterizes the intertemporal trade-off in consumption.\nBy substituting equations (1) through (3) into the system and rearranging, the model can be expressed in the form of a moment condition:\n\\[\n    \\mathbb{E}_{t}\\Biggl[ F(x_{t+1}, y_{t+1}, x_{t}, y_{t}, z_{t}; \\theta) \\Biggr] = 0\n\\]\nThis formulation embeds the Euler condition within a broader structural framework suitable for estimation or simulation."
  },
  {
    "objectID": "notes/GE.html",
    "href": "notes/GE.html",
    "title": "Notes on General Equilibrium",
    "section": "",
    "text": "General Equilibrium Theory\n\n“The two central problems of the theory that this monograph presents are (1) the explanation of the prices of commodities resulting from the interaction of the agents of a private ownership economy through markets, (2) the explanation of the role of prices in an optimal state of an economy. The analysis is therefore organized around the concept of a price system or, more generally, of a value function defined on the commodity space.”\n— Gérard Debreu, The Theory of Value\n\nNow, let us view a competitive economy from the general equilibrium perspective. As Debreu (1959) emphasizes, general equilibrium theory seeks to explain how the prices of commodities emerge from the interactions of agents in a market economy, and how those prices, in turn, sustain an optimal allocation of resources.\nConsider an economy with \\(H\\) commodities indexed by \\(h \\in \\mathcal{H} = {1, \\dots, H}\\), \\(I\\) consumers indexed by \\(i \\in \\mathcal{I} = {1, \\dots, I}\\), and \\(J\\) producers or firms indexed by \\(j \\in \\mathcal{J} = {1, \\dots, J}\\).\nConsumers derive utility from consuming goods. Let \\(X\\) denote the consumption correspondence, which maps each consumer \\(i \\in \\mathcal{I}\\) to a subset \\(X(i) = X_i \\subseteq \\mathbb{R}^{\\mathcal{H}}\\) of the commodity space, representing the set of consumption bundles available to that consumer. Each element \\(x_i \\in X_i\\) is a consumption bundle (or consumption vector), describing quantities of all commodities that the consumer may feasibly consume.\nLet \\(R\\) be a preference correspondence that maps each \\(i \\in \\mathcal{I}\\) to a reflexive binary relation \\(R(i) = R_i \\subseteq X_i \\times X_i\\) over \\(X_i\\), representing the consumer’s preference ordering such that \\((x_i, x_i) \\in R_i\\) for all \\(x_i \\in X_i\\).\nEach producer \\(j \\in \\mathcal{J}\\) operates a production set \\(Y(j) = Y_j \\subseteq \\mathbb{R}^{\\mathcal{H}}\\), where each element \\(y_j \\in Y_j\\) is a production bundle (or production vector) describing quantities of inputs and outputs across commodities.\nThe total resources available in the economy are represented by an aggregate endowment vector \\(\\bar{\\omega} \\in \\mathbb{R}^{\\mathcal{H}}\\), where \\(\\bar{\\omega} = (\\bar{\\omega}(h))_{h \\in \\mathcal{H}} = (\\bar{\\omega}h){h \\in \\mathcal{H}}\\) specifies the total amount of each commodity in the economy, not necessarily individualized among agents. These commodities are assumed to be pre-existing and dated. It means that each good has a defined origin in time.\n\nDefinition 1 (Economy) The list \\((\\mathcal{H}, \\mathcal{I}, \\mathcal{J}, X, R, Y, \\bar{\\omega})\\) is an economy if\n\n\\(\\mathcal{H}\\) is a nonempty finite set of commodities;\n\\(\\mathcal{I}\\) is a nonempty finite set of consumers;\n\\(\\mathcal{J}\\) is a nonempty finite set of producers or firms;\n\\(X\\) is a correspondence from \\(\\mathcal{I}\\) to the commodity space \\(\\mathbb{R}^{\\mathcal{H}}\\);\n\\(R\\) is a correspondence from \\(\\mathcal{I}\\) to \\(\\mathbb{R}^{\\mathcal{H}} \\times \\mathbb{R}^{\\mathcal{H}}\\) such that \\(R(i)\\) is a reflexive binary relation over \\(X_{i}\\) s.t. \\((x_{i},x_{i}) \\in R_{i}\\) for each \\(x_{i} \\in X_{i}\\);\n\\(Y\\) is a correspondence from \\(\\mathcal{J}\\) to \\(\\mathbb{R}^{\\mathcal{H}}\\); and\n\\(\\bar{\\omega}\\) is a point of \\(\\mathbb{R}^{\\mathcal{H}}\\).\n\n\n\nDefinition 2 (Feasible Allocation) Let \\((\\mathcal{H}, \\mathcal{I}, \\mathcal{J}, X, R, Y, \\bar{\\omega})\\) be an economy. Then \\((x, y) \\in (\\mathbb{R}^{\\mathcal{H}})^{\\mathcal{I}} \\times (\\mathbb{R}^{\\mathcal{H}})^{\\mathcal{J}}\\) is a feasible allocation for \\((\\mathcal{H}, \\mathcal{I}, \\mathcal{J}, X, R, Y, \\bar{\\omega})\\) if \\((x, y) \\in X \\times Y\\) and \\(\\sum_{i \\in \\mathcal{I}}x_{i}=\\bar{\\omega}+\\sum_{j \\in \\mathcal{J}}y_{i}\\)."
  },
  {
    "objectID": "notes/RA.html",
    "href": "notes/RA.html",
    "title": "Notes on Representative Agents",
    "section": "",
    "text": "Macroeconomics often assumes a representative individual to describe household behavior and aggregate welfare. This simplification builds on the Second Fundamental Theorem of Welfare Economics, which shows that a social planner can achieve a Pareto-efficient allocation of resources. By assigning proper welfare weights to each household, a centralized economy can replicate the outcomes of competitive markets.\nHowever, assuming that one individual can represent an entire population is a strong abstraction. It ignores differences in income, preferences, and opportunities across people. Recent studies have moved beyond this idea, developing models that incorporate household heterogeneity and inequality.\nEven so, the representative individual remains central to modern macroeconomics. Critics, following the Debreu–Sonnenschein–Mantel theorem, argue that aggregating individual behavior into a single agent is theoretically inconsistent. Others see it as a useful simplification that can approximate aggregate outcomes under certain assumptions.\n\n\nWhen studying how prices and income affect demand, economists usually work with market-level data rather than household-level observations. For businesses and policymakers, what matters is the overall demand curve, not each household’s choices. Ideally, a few parameters could summarize how total demand responds to changes in prices and income.\nThis raises a key question: if we only observe aggregate data, what kind of utility function should we assume for individuals? Microeconomic theory provides clear conditions—such as convex, continuous, and transitive preferences—under which individual demand satisfies symmetry, homogeneity, and the weak axiom of revealed preference.\nYet these properties do not necessarily hold when we aggregate across many households. Market demand may behave quite differently from individual demand. Even if individual preferences are non-convex, the overall demand function can still appear smooth and continuous. This insight lies at the heart of the Debreu–Sonnenschein–Mantel theorem, which shows that aggregate demand can take almost any shape consistent with Walras’ law and continuity, regardless of individual preferences.\n\nTheorem 1 (Debreu-Mantel-Sonnenschein Theorem) Let \\(\\epsilon &gt;0\\) and \\(N \\in \\mathbb{N}\\). Consider a set of prices \\(\\textbf{P}_{\\epsilon}=\\{p \\in \\mathbb{R}^{N}_{+}: p_{j}/p_{j'} \\geq \\epsilon,~\\forall j~\\text{and}~ j' \\}\\) and any continuous function \\(\\textbf{x}: \\textbf{P}_{\\epsilon} \\rightarrow \\mathbb{R}^{N}_{+}\\) that satisfies Walras’s Law and is homogeneous of degree 0. Then there exists an exchange economy with \\(N\\) commodities and \\(H&lt;\\infty\\) households, where the aggregate excess demand is given by \\(\\textbf{x}(p)\\) over the set \\(\\textbf{P}_{\\epsilon}\\)"
  },
  {
    "objectID": "notes/RA.html#debreu-mantel-sonnenschein-theorem",
    "href": "notes/RA.html#debreu-mantel-sonnenschein-theorem",
    "title": "Notes on Representative Agents",
    "section": "",
    "text": "When studying how prices and income affect demand, economists usually work with market-level data rather than household-level observations. For businesses and policymakers, what matters is the overall demand curve, not each household’s choices. Ideally, a few parameters could summarize how total demand responds to changes in prices and income.\nThis raises a key question: if we only observe aggregate data, what kind of utility function should we assume for individuals? Microeconomic theory provides clear conditions—such as convex, continuous, and transitive preferences—under which individual demand satisfies symmetry, homogeneity, and the weak axiom of revealed preference.\nYet these properties do not necessarily hold when we aggregate across many households. Market demand may behave quite differently from individual demand. Even if individual preferences are non-convex, the overall demand function can still appear smooth and continuous. This insight lies at the heart of the Debreu–Sonnenschein–Mantel theorem, which shows that aggregate demand can take almost any shape consistent with Walras’ law and continuity, regardless of individual preferences.\n\nTheorem 1 (Debreu-Mantel-Sonnenschein Theorem) Let \\(\\epsilon &gt;0\\) and \\(N \\in \\mathbb{N}\\). Consider a set of prices \\(\\textbf{P}_{\\epsilon}=\\{p \\in \\mathbb{R}^{N}_{+}: p_{j}/p_{j'} \\geq \\epsilon,~\\forall j~\\text{and}~ j' \\}\\) and any continuous function \\(\\textbf{x}: \\textbf{P}_{\\epsilon} \\rightarrow \\mathbb{R}^{N}_{+}\\) that satisfies Walras’s Law and is homogeneous of degree 0. Then there exists an exchange economy with \\(N\\) commodities and \\(H&lt;\\infty\\) households, where the aggregate excess demand is given by \\(\\textbf{x}(p)\\) over the set \\(\\textbf{P}_{\\epsilon}\\)"
  }
]